// Core: initial header + sidebar injection (minimal, no heavy logic)
(function(){
  const path = window.location.pathname.toLowerCase();
  const isHome = /homepage\.html$/.test(path);
  const isMessages = /messages\.html$/.test(path);
  const isChatList = /chat\.html$/.test(path);
  const isDM = /dm\.html$/.test(path);
  const params = new URLSearchParams(window.location.search);
  const dmUserSlug = params.get('u') || '';
  function formatDisplayName(slug){ if(!slug) return 'Ama Kusi'; const base=decodeURIComponent(slug).replace(/[_+-]+/g,' ').trim(); return base.split(/\s+/).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(' '); }
  function buildTopNav(){
    if(isChatList){ return `<div id="fixed-ui" class="fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-sm z-50"><div class="backdrop-blur-md bg-black/60 border-b border-white/15 shadow-lg"><div class="px-2 py-2 flex items-center gap-3"><button onclick="history.back()" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="Back"><i data-lucide="chevron-left" class="w-5 h-5"></i></button><h1 class="text-base font-semibold">Chats</h1></div></div></div>`; }
    if(isDM){ let seed=1012; if(dmUserSlug){ let hash=0; for(let i=0;i<dmUserSlug.length;i++){ hash=(hash*31+dmUserSlug.charCodeAt(i))>>>0; } seed=1000+(hash%50);} const avatarUrl=`https://picsum.photos/id/${seed}/80/80`; const displayName=formatDisplayName(dmUserSlug); return `<div id="fixed-ui" class="fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-sm z-50"><div class="backdrop-blur-md bg-black/50 border-b border-white/15 shadow-lg"><div class="px-2 py-2 flex items-center gap-2"><button onclick="history.back()" aria-label="Back" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10"><i data-lucide="chevron-left" class="w-5 h-5"></i></button><div class="w-9 h-9 rounded-full overflow-hidden border border-white/20"><img src="${avatarUrl}" class="w-full h-full object-cover" alt="avatar"/></div><div class="flex-1 leading-tight min-w-0"><p class="text-sm font-semibold truncate">${displayName}</p><p class="text-[10px] text-green-400">online</p></div><div class="flex items-center gap-1"><button class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="Call"><i data-lucide="phone" class="w-5 h-5"></i></button><button class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="More"><i data-lucide="more-vertical" class="w-5 h-5"></i></button></div></div></div></div>`; }
    const active=(name)=> window.PAGE_ACTIVE===name ? 'text-orange-400':'hover:text-orange-400';
    let extra='';
    if(isHome){ extra=`<div class=\"px-4 pb-3 pt-1\"><div class=\"px-3 pt-2 flex items-center space-x-2 bg-white/5 border border-white/10 rounded-2xl backdrop-blur\"><div class=\"w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500\"><img src=\"https://picsum.photos/id/1019/40/40\" class=\"w-full h-full object-cover\" alt=\"me\"></div><input id=\"openComposerModal\" readonly placeholder=\"What's on your mind?\" class=\"flex-1 bg-black/30 text-white placeholder-gray-300 rounded-full px-3 py-2 text-sm cursor-pointer focus:outline-none\"><button id=\"composerMediaBtn\" class=\"p-2 rounded-full bg-black/30 border border-gray-600 hover:bg-orange-500 hover:text-white transition\" aria-label=\"Add media\"><i data-lucide=\"image\" class=\"w-5 h-5\"></i></button><input id=\"composerFile\" type=\"file\" accept=\"image/*,video/*\" class=\"hidden\" /></div></div>`; }
    else if(isMessages){ extra=`<div class=\"px-4 pt-2\"><div class=\"flex items-center gap-2\"><a href=\"Homepage.html\" aria-label=\"Back\" class=\"w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10\"><i data-lucide=\"chevron-left\" class=\"w-5 h-5\"></i></a><h1 class=\"text-lg font-semibold\">Messages</h1></div></div>`; }
    return `<div id=\"fixed-ui\" class=\"fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-sm z-50\"><div class=\"backdrop-blur-md bg-white/10 border-b border-white/20 shadow-lg overflow-hidden\"><div class=\"px-4 py-3\"><nav class=\"flex items-center justify-between\"><div class=\"flex items-center space-x-2\"><button id=\"openSidebarBtn\" class=\"text-gray-300 hover:text-white\" aria-label=\"Menu\"><svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16m-7 6h7\"/></svg></button><span class=\"text-2xl font-bold text-orange-500\">Paired</span></div><div class=\"flex items-center space-x-2\"><button id=\"openSearch\" class=\"flex items-center justify-center w-9 h-9 rounded-full bg-gray-400/10 backdrop-blur-md border border-gray-600 hover:bg-white/10\" aria-label=\"Search\"><i data-lucide=\"search\" class=\"w-5 h-5 text-white\"></i></button><a href=\"chat.html\" class=\"flex items-center justify-center w-9 h-9 rounded-full bg-gray-400/10 backdrop-blur-md border border-gray-600 hover:bg-white/10\" aria-label=\"Messages\"><i data-lucide=\"send\" class=\"w-5 h-5 text-white -rotate-45\"></i></a></div></nav>${!isMessages?`<nav id=\"mainNavIcons\" class=\"flex justify-around mt-3 text-white font-medium space-x-9 text-sm\"><a href=\"Homepage.html\" class=\"${active('home')}\" title=\"Home\"><i data-lucide=\"home\"></i></a><a href=\"friends.html\" class=\"${active('friends')}\" title=\"Friends\"><i data-lucide=\"users\"></i></a><a href=\"market.html\" class=\"${active('market')}\" title=\"Marketplace\"><i data-lucide=\"shopping-bag\"></i></a><a href=\"Notification.html\" class=\"${active('notifications')}\" title=\"Notifications\"><i data-lucide=\"bell\"></i></a><a href=\"profile.html\" class=\"${active('profile')}\" title=\"Profile\"><i data-lucide=\"user\"></i></a></nav>`:''}</div>${extra}</div></div>`;
  }
  function buildSidebar(){ return `<div id=\"sidebar-container\" class=\"fixed inset-0 z-[1001] pointer-events-none\"><div id=\"sidebar-overlay\" class=\"absolute inset-0 bg-black/60 opacity-0 hidden transition-opacity\"></div><div id=\"sidebar\" style=\"transform:translateX(-100%);\" class=\"relative z-10 w-64 h-full bg-black/60 backdrop-blur-xl border-r border-white/10 p-6 flex flex-col\"> <div class=\"flex items-center gap-3 mb-8\"><div class=\"w-12 h-12 rounded-full overflow-hidden border-2 border-orange-500\"><img src=\"https://picsum.photos/id/1019/80/80\" alt=\"user\" class=\"w-full h-full object-cover\"></div><div><p class=\"font-semibold flex items-center\">You <span data-premium-badge></span></p><p class=\"text-xs text-gray-400\">@your_username</p></div></div><nav class=\"flex flex-col space-y-1 text-gray-300 text-sm\"><a href=\"profile.html\" class=\"flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-white/10 hover:text-white transition\"><i data-lucide=\"user\" class=\"w-5 h-5\"></i><span>Profile</span></a><a href=\"upgradeTopremium.html\" class=\"flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-white/10 hover:text-white transition\"><i data-lucide=\"crown\" class=\"w-5 h-5 text-yellow-400\"></i><span>${window.PairedState?.isPremium()? 'Manage Premium':'Go Premium'}</span></a><a href=\"market.html\" class=\"flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-white/10 hover:text-white transition\"><i data-lucide=\"shopping-bag\" class=\"w-5 h-5\"></i><span>Marketplace</span></a><a href=\"Bookmarks.html\" class=\"flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-white/10 hover:text-white transition\"><i data-lucide=\"bookmark\" class=\"w-5 h-5\"></i><span>Bookmarks</span></a><a href=\"postAd.html\" class=\"flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-white/10 hover:text-white transition\"><i data-lucide=\"megaphone\" class=\"w-5 h-5\"></i><span>Post Ad or Event</span></a><a href=\"Settings.html\" class=\"flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-white/10 hover:text-white transition\"><i data-lucide=\"settings\" class=\"w-5 h-5\"></i><span>Settings</span></a><div class=\"flex items-center justify-between px-4 py-2.5 rounded-lg hover:bg-white/10 hover:text-white transition\"><div class=\"flex items-center gap-3\"><i data-lucide=\"moon\" class=\"w-5 h-5\"></i><span>Theme</span></div><label class=\"inline-flex items-center cursor-pointer select-none\"><input type=\"checkbox\" data-theme-toggle class=\"sr-only peer\" /><span class=\"w-10 h-5 bg-white/15 peer-checked:bg-gradient-to-r peer-checked:from-orange-500 peer-checked:to-pink-600 rounded-full relative transition-colors after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:w-4 after:h-4 after:bg-white after:rounded-full after:shadow after:transition-transform peer-checked:after:translate-x-5\"></span></label></div></nav><div class=\"mt-auto pt-6 border-t border-white/10\"><a href=\"index.html\" class=\"flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-red-500/20 text-red-400 hover:text-red-300 transition\"><i data-lucide=\"log-out\" class=\"w-5 h-5\"></i><span>Logout</span></a></div></div></div>`; }
  function inject(){
    if(document.getElementById('fixed-ui')){ if(window.lucide) lucide.createIcons(); return; }
    document.body.insertAdjacentHTML('afterbegin', buildTopNav()+buildSidebar());
    if(window.lucide) lucide.createIcons();
    requestAnimationFrame(()=>{ const ui=document.getElementById('fixed-ui'); if(ui){ document.body.style.paddingTop = ui.getBoundingClientRect().height + 'px'; }});
  }
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', inject); else inject();
})();
