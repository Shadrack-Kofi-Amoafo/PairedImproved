// Extras: global search modal, toast helper, hashtag/mention navigation, theme sync, sidebar logic
(function(){
  function attachSidebarLogic(){ const openSidebarBtn=document.getElementById('openSidebarBtn'); const sidebar=document.getElementById('sidebar'); const overlay=document.getElementById('sidebar-overlay'); const container=document.getElementById('sidebar-container'); function openSidebar(){ container.classList.remove('pointer-events-none'); overlay.classList.remove('hidden'); requestAnimationFrame(()=>{ sidebar.style.transform='translateX(0)'; overlay.style.opacity='1';}); } function closeSidebar(){ sidebar.style.transform='translateX(-100%)'; overlay.style.opacity='0'; setTimeout(()=>{ overlay.classList.add('hidden'); container.classList.add('pointer-events-none');},300);} openSidebarBtn?.addEventListener('click', openSidebar); overlay?.addEventListener('click', closeSidebar); }
  function ensureSidebar(){ if(!document.getElementById('sidebar')){ setTimeout(ensureSidebar,80); return;} attachSidebarLogic(); }
  ensureSidebar();
  if(!document.getElementById('toastHost')){ const host=document.createElement('div'); host.id='toastHost'; host.className='fixed z-[1400] inset-x-0 top-3 flex flex-col items-center gap-2 pointer-events-none'; document.body.appendChild(host);} 
  window.showToast = function(msg, opts={}){ const host=document.getElementById('toastHost'); if(!host) return alert(msg); const div=document.createElement('div'); div.className='pointer-events-auto text-xs px-3 py-2 rounded-lg bg-black/80 backdrop-blur border border-white/15 shadow-sm'; div.textContent=msg; host.appendChild(div); setTimeout(()=>{ div.style.opacity='0'; div.style.transform='translateY(-4px)'; div.style.transition='all .3s'; setTimeout(()=>div.remove(),320); }, opts.duration||2400); };
  document.addEventListener('click', e=>{ const tag=e.target.closest('.hashtag'); if(tag){ const raw=tag.dataset.tag||tag.textContent||''; const clean=raw.replace(/^#/, ''); const isMobile=window.innerWidth<=700 || window.matchMedia('(max-width:700px)').matches || window.matchMedia('(pointer:coarse)').matches; if(isMobile){ e.preventDefault(); e.stopPropagation(); setTimeout(()=>{ window.location.href='search.html?tag='+encodeURIComponent(clean); },20); return;} window.dispatchEvent(new CustomEvent('PairedFilterHashtag',{ detail:{ tag: clean } })); return;} const men=e.target.closest('.mention'); if(men){ const raw=men.dataset.mention||men.textContent||''; const user=raw.replace(/^@/,'').toLowerCase(); window.location.href='PeopleProfile.html?u='+encodeURIComponent(user); return;} });
  if('serviceWorker' in navigator){ window.addEventListener('load', ()=>{ navigator.serviceWorker.register('sw.js').catch(err=>console.warn('[SW] registration failed', err)); }); }
  // theme toggle sync if loaded after
  document.addEventListener('DOMContentLoaded', ()=>{ try{ document.querySelectorAll('input[data-theme-toggle][type="checkbox"]').forEach(cb=>{ cb.checked=window.PairedTheme?.isDark?.()||false; if(!cb._pairedThemeBound){ cb.addEventListener('change', ()=> window.PairedTheme?.setDark?.(cb.checked)); cb._pairedThemeBound=true; } }); }catch(e){} });
})();
