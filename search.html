<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <title>Search • Paired</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0" />
  <meta name="theme-color" content="#000000" />
  <link rel="manifest" href="manifest.webmanifest" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="styles.css" />
  <script src="theme.js"></script>
  <script>window.PAGE_ACTIVE='home';</script>
  <script src="shared-ui.js"></script>
  <style>
    .orb-lemon {background:radial-gradient(circle,rgba(255,255,0,0.35) 0%,rgba(0,0,0,0) 70%);filter:blur(60px);}
    .orb-violet {background:radial-gradient(circle,rgba(186,85,211,0.35) 0%,rgba(0,0,0,0) 70%);filter:blur(60px);}
    ::-webkit-scrollbar{width:8px}
    ::-webkit-scrollbar-track{background:transparent}
    ::-webkit-scrollbar-thumb{background:#333;border-radius:4px}
    .fade-edge:after{
      content:"";position:absolute;inset-inline-end:0;top:0;height:100%;width:60px;
      background:linear-gradient(to right,transparent,rgba(0,0,0,.8));
      pointer-events:none;
    }
  </style>
</head>
<body class="bg-black text-gray-100 min-h-full relative">
  <!-- Background Orbs -->
  <div class="absolute inset-0 -z-10 pointer-events-none">
    <div class="absolute top-10 left-10 w-72 h-72 orb-lemon rounded-full"></div>
    <div class="absolute bottom-10 right-10 w-80 h-80 orb-violet rounded-full"></div>
  </div>

  <!-- Search Bar (now within flow under shared header) -->
  <div class="max-w-sm mx-auto px-4 pt-4 mb-5 flex items-center gap-2" data-adjust-offset>
    <button id="closeSearch" type="button" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/5 hover:bg-white/10 shrink-0" aria-label="Close search">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/></svg>
    </button>
  <form id="searchForm" class="relative flex items-center gap-2 flex-1">
      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-4.35-4.35M18 11a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z" />
        </svg>
      </span>
  <input id="searchInput" autocomplete="off" class="w-full bg-white/10 focus:bg-white/15 transition rounded-full pl-11 pr-24 h-11 outline-none text-sm placeholder-gray-400" placeholder="Search people, posts, marketplace..." />
  <button id="searchBtn" type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1.5 rounded-full bg-indigo-600 hover:bg-indigo-500 text-xs font-medium">Search</button>
    </form>
  </div>

  <!-- Main Content -->
  <main class="pb-24 max-w-sm mx-auto px-4 space-y-10" data-adjust-offset>
    <!-- Recent Searches -->
    <section id="recentSection" class="bg-white/5 rounded-2xl border border-white/10 p-5 backdrop-blur-md hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-gray-300">Recent</h2>
        <button id="clearRecent" class="text-[10px] px-2 py-1 rounded-full bg-white/10 hover:bg-white/20">Clear</button>
      </div>
      <div id="recentList" class="flex flex-wrap gap-2"></div>
    </section>

    <!-- Trending -->
    <section class="bg-white/5 rounded-2xl border border-white/10 p-5 backdrop-blur-md">
      <h2 class="text-sm font-semibold uppercase tracking-wider text-gray-300 mb-4">Trending Now</h2>
      <ul id="trendingList" class="space-y-3 text-sm">
        <!-- Filled by JS -->
      </ul>
    </section>

    <!-- Results -->
    <section id="resultsWrap" class="hidden space-y-6">
      <div class="flex items-center justify-between">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-gray-300">Results</h2>
        <button id="refineBtn" class="text-[10px] px-3 py-1 rounded-full bg-white/10 hover:bg-white/20">Refine</button>
      </div>
      <div id="results" class="grid gap-4"></div>
    </section>

    <!-- Empty state (initial) -->
    <div id="emptyState" class="text-center text-sm text-gray-400 pt-10">
      Start typing to search the network.
    </div>
  </main>

  <!-- Refinement Drawer -->
  <div id="refineDrawer"
       class="fixed inset-y-0 right-0 w-72 max-w-full bg-black/80 backdrop-blur-xl border-l border-white/10 p-5 z-30 translate-x-full transition-transform">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-300">Refine</h3>
      <button id="closeRefine" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 stroke-white" fill="none" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m6 6 12 12M18 6 6 18"/>
        </svg>
      </button>
    </div>
    <form id="filterForm" class="space-y-5 text-xs">
      <div class="space-y-2">
        <p class="font-medium text-gray-300">Type</p>
        <div class="flex flex-wrap gap-2">
          <label class="px-3 py-1 rounded-full bg-white/10 hover:bg-white/20 cursor-pointer">
            <input type="checkbox" name="type" value="people" class="hidden" checked> People
          </label>
          <label class="px-3 py-1 rounded-full bg-white/10 hover:bg-white/20 cursor-pointer">
            <input type="checkbox" name="type" value="posts" class="hidden" checked> Posts
          </label>
          <label class="px-3 py-1 rounded-full bg-white/10 hover:bg-white/20 cursor-pointer">
            <input type="checkbox" name="type" value="market" class="hidden" checked> Marketplace
          </label>
        </div>
      </div>
      <div class="space-y-2">
        <p class="font-medium text-gray-300">Sort</p>
        <select name="sort"
                class="w-full bg-white/10 rounded-lg px-3 py-2 focus:outline-none focus:ring ring-indigo-500/50">
          <option value="relevance">Relevance</option>
          <option value="latest">Latest</option>
          <option value="popular">Most Popular</option>
        </select>
      </div>
      <div class="space-y-2">
        <p class="font-medium text-gray-300">Date Range</p>
        <select name="range"
                class="w-full bg-white/10 rounded-lg px-3 py-2 focus:outline-none focus:ring ring-indigo-500/50">
          <option value="">Any time</option>
          <option value="day">Past 24h</option>
          <option value="week">Past week</option>
          <option value="month">Past month</option>
          <option value="year">Past year</option>
        </select>
      </div>
      <button type="submit"
              class="w-full py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 font-medium text-[11px]">
        Apply Filters
      </button>
    </form>
  </div>

  <script>
  const recentKey = 'paired.recentSearches';
    const input = document.getElementById('searchInput');
    const form = document.getElementById('searchForm');
    const recentList = document.getElementById('recentList');
    const recentSection = document.getElementById('recentSection');
    const resultsWrap = document.getElementById('resultsWrap');
    const resultsEl = document.getElementById('results');
    const emptyState = document.getElementById('emptyState');
    const clearRecent = document.getElementById('clearRecent');
    const refineBtn = document.getElementById('refineBtn');
    const refineDrawer = document.getElementById('refineDrawer');
    const closeRefine = document.getElementById('closeRefine');

    const trending = [
      'New connections','Remote jobs','AI design','Summer events',
      'Marketplace deals','Music producers','Photography tips','Growth','Focus'
    ];
    const trendingList = document.getElementById('trendingList');
    function renderTrending(activeTag){
      trendingList.innerHTML='';
      trending.forEach((t,i)=>{
        const isActive = activeTag && t.toLowerCase()===activeTag.toLowerCase();
        const li = document.createElement('li');
        li.innerHTML = '<button class="w-full text-left flex items-center gap-3 group hover:text-white '+(isActive?'text-orange-400':'')+'">' +
          '<span class="text-[10px] w-5 h-5 flex items-center justify-center rounded-full '+(isActive?'bg-orange-600':'bg-white/10 group-hover:bg-indigo-600')+'">'+(i+1)+'</span>' +
          '<span>'+t+'</span></button>';
        li.querySelector('button').addEventListener('click',()=> { input.value=t; executeSearch(t); });
        trendingList.appendChild(li);
      });
    }
    renderTrending();

    function loadRecent(){
      let arr=[];
      try{arr=JSON.parse(localStorage.getItem(recentKey)||'[]');}catch(e){}
      recentList.innerHTML='';
      if(!arr.length){recentSection.classList.add('hidden');return;}
      recentSection.classList.remove('hidden');
      arr.forEach(term=>{
        const chip=document.createElement('button');
        chip.className='px-3 py-1 rounded-full bg-white/10 hover:bg-white/20 text-xs flex items-center gap-2 group';
        chip.innerHTML='<span>'+term+'</span><span class="text-white/40 group-hover:text-red-400 text-[10px]">&times;</span>';
        chip.addEventListener('click',e=>{
          if(e.offsetX > chip.clientWidth - 16){ // close icon zone
            removeRecent(term);
          } else {
            input.value=term;
            executeSearch(term);
          }
        });
        recentList.appendChild(chip);
      });
    }
    function saveRecent(term){
      term = term.trim();
      if(!term) return;
      let arr=[];
      try{arr=JSON.parse(localStorage.getItem(recentKey)||'[]');}catch(e){}
      arr = [term, ...arr.filter(t=>t.toLowerCase()!==term.toLowerCase())].slice(0,12);
      localStorage.setItem(recentKey, JSON.stringify(arr));
      loadRecent();
    }
    function removeRecent(term){
      let arr=[];
      try{arr=JSON.parse(localStorage.getItem(recentKey)||'[]');}catch(e){}
      arr = arr.filter(t=>t!==term);
      localStorage.setItem(recentKey, JSON.stringify(arr));
      loadRecent();
    }

    clearRecent.addEventListener('click', ()=>{
      localStorage.removeItem(recentKey);
      loadRecent();
    });

    function executeSearch(q){
      q=q.trim();
      if(!q){return;}
      saveRecent(q);
      emptyState.classList.add('hidden');
      resultsWrap.classList.remove('hidden');
      resultsEl.innerHTML='';
      const filters = getFilters();
      // Mock results
      const sample = [];
      if(filters.types.includes('people')) sample.push({type:'people', name:q+' User', meta:'Mutual friends: 3'});
      if(filters.types.includes('posts')) sample.push({type:'post', name:'Post about '+q, meta:'124 likes • 9 comments'});
      if(filters.types.includes('market')) sample.push({type:'market', name:q+' Item', meta:'$25 • In stock'});
      sample.forEach(r=>{
        const card=document.createElement('div');
        card.className='rounded-xl bg-white/5 border border-white/10 p-4 flex items-start gap-4 hover:bg-white/10 transition';
        let icon='';
        if(r.type==='people') icon='👤';
        else if(r.type==='post') icon='📝';
        else icon='🛒';
        card.innerHTML='<div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-lg">'+icon+'</div>'+
          '<div class="flex-1">'+
          '<p class="text-sm font-medium">'+r.name+'</p>'+
          '<p class="text-[11px] text-gray-400">'+r.meta+'</p>'+
          '</div>';
        resultsEl.appendChild(card);
      });
      if(!sample.length){
        resultsEl.innerHTML='<div class="text-center text-xs text-gray-400 py-10">No matches with current filters.</div>';
      }
      renderTrending(q.startsWith('#')?q.slice(1):q);
    }

    form.addEventListener('submit', e=>{
      e.preventDefault();
      executeSearch(input.value);
    });

    input.addEventListener('keydown', e=>{
      if(e.key==='Escape'){closePage();}
    });

    // Refinement
    function getFilters(){
      const types = Array.from(document.querySelectorAll('#filterForm input[name="type"]'))
        .filter(i=>i.checked).map(i=>i.value);
      const sort = document.querySelector('#filterForm select[name="sort"]').value;
      const range = document.querySelector('#filterForm select[name="range"]').value;
      return {types, sort, range};
    }
    document.getElementById('filterForm').addEventListener('submit', e=>{
      e.preventDefault();
      refineDrawer.classList.add('translate-x-full');
      if(input.value.trim()) executeSearch(input.value);
    });

    refineBtn.addEventListener('click', ()=>{
      refineDrawer.classList.remove('translate-x-full');
    });
    closeRefine.addEventListener('click', ()=>{
      refineDrawer.classList.add('translate-x-full');
    });
    document.addEventListener('keydown', e=>{
      if(e.key==='Escape') refineDrawer.classList.add('translate-x-full');
    });

    // Close search
    function closePage(){
      if(document.referrer){
        history.back();
      } else {
        window.location.href='Homepage.html';
      }
    }
  const closeBtn=document.getElementById('closeSearch');
  if(closeBtn) closeBtn.addEventListener('click', closePage);

    // Tag param support (?tag=Growth) makes search button orange & pre-fills
    (function initFromParams(){
      const params=new URLSearchParams(window.location.search);
      const tag=params.get('tag');
      if(tag){
        const normalized=tag.replace(/^#/,'');
        input.value = '#'+normalized;
        const btn=document.getElementById('searchBtn');
        if(btn){ btn.classList.remove('bg-indigo-600','hover:bg-indigo-500'); btn.classList.add('bg-orange-600','hover:bg-orange-500'); }
        executeSearch('#'+normalized);
      }
    })();
    // Init recents & focus
    loadRecent();
    setTimeout(()=>input.focus(), 50);
  </script>
</body>
</html>