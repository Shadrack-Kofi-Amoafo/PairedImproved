<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.webmanifest">
  <title>Paired</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="styles.css" />
  <script src="theme.js"></script>
  <script>window.PAGE_ACTIVE='home';</script>
  <script src="shared-ui.js"></script>
  <style>
    /* Orbs animation */
    .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.6; animation: float 20s infinite ease-in-out; }
    .orb1 { width: 300px; height: 300px; background: orange; top: 5%; left: 5%; animation-duration: 25s; }
    .orb2 { width: 250px; height: 250px; background: purple; bottom: 8%; right: 5%; animation-duration: 22s; }
    .orb3 { width: 220px; height: 220px; background: teal; top: 35%; left: 50%; animation-duration: 28s; }
    @keyframes float { 0%, 100% { transform: translateY(0) translateX(0); } 50% { transform: translateY(-30px) translateX(30px); } }
    /* Hide scrollbar utility */
    .no-scrollbar { scrollbar-width: none; -ms-overflow-style: none; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    /* Sidebar transition */
    #sidebar { transition: transform 0.3s ease-in-out; }
    .sidebar-open { transform: translateX(0) !important; }
    #sidebar-overlay { transition: opacity 0.3s ease-in-out; }
  /* Fallback for theme-light text override */
  .theme-light .theme-light\:text-black { color:#000 !important; }
  .theme-light .badge-new { color:#000 !important; background:rgba(255,165,0,0.25) !important; }
  /* Skeleton shimmer */
  .skeleton{position:relative;overflow:hidden;background:linear-gradient(90deg,#1f1f1f 25%,#2a2a2a 37%,#1f1f1f 63%);background-size:400% 100%;animation:skeleton 1.2s ease-in-out infinite;}
  @keyframes skeleton{0%{background-position:100% 50%}100%{background-position:0 50%}}
  </style>
</head>
<body class="bg-black text-white min-h-screen overflow-y-auto overflow-x-hidden relative flex justify-center">

  <div class="absolute inset-0 -z-10">
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
    <div class="orb orb3"></div>

  </div>
  
  <!-- Header + composer injected by shared-ui.js -->

  <main id="feed" class="w-full max-w-sm mx-auto relative z-10 pb-10" data-adjust-offset>
    <!-- Dynamic hashtag filter bar (shown when a hashtag is selected) -->
    <div id="hashtagFilterBar" class="hidden px-4 pt-2"></div>
    <div id="feedSkeleton" class="px-4 pt-4 space-y-5 hidden">
      <div class="bg-white/5 border border-white/10 rounded-xl p-4 space-y-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full skeleton"></div>
          <div class="flex-1 space-y-2">
            <div class="h-3 w-24 rounded skeleton"></div>
            <div class="h-2 w-16 rounded skeleton"></div>
          </div>
        </div>
        <div class="h-3 w-5/6 rounded skeleton"></div>
        <div class="h-3 w-2/3 rounded skeleton"></div>
        <div class="h-40 rounded-lg skeleton"></div>
      </div>
      <div class="bg-white/5 border border-white/10 rounded-xl p-4 space-y-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full skeleton"></div>
          <div class="flex-1 space-y-2">
            <div class="h-3 w-28 rounded skeleton"></div>
            <div class="h-2 w-20 rounded skeleton"></div>
          </div>
        </div>
        <div class="h-3 w-4/5 rounded skeleton"></div>
        <div class="h-3 w-1/2 rounded skeleton"></div>
        <div class="grid grid-cols-2 gap-2">
          <div class="h-24 rounded skeleton"></div>
          <div class="h-24 rounded skeleton"></div>
        </div>
      </div>
    </div>
    <div class="space-y-5 px-4 pt-4" id="posts">
      <article class="post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden" data-post-id="1">
        <div class="flex items-start gap-3 px-4 pt-4">
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/id/1005/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
          <div class="flex-1">
            <div class="flex items-center gap-2 flex-wrap"><p class="text-sm font-semibold profile-link cursor-pointer">Kwame Boateng</p><span class="badge-new text-[10px] px-1.5 py-0.5 rounded bg-orange-600/30 text-orange-300">New</span></div>
            <p class="text-[11px] text-gray-400">2 hrs ago ¬∑ UCC Campus</p>
          </div>
          <button class="p-1 text-gray-400 hover:text-white"><i data-lucide="ellipsis"></i></button>
        </div>
        <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200">Had an amazing study group today. Proud of the progress everyone's making! #Focus #Growth</div>
        <div class="mt-3 bg-black/30"><img src="https://picsum.photos/id/1040/600/400" alt="post media" class="w-full object-cover max-h-80"></div>
        <div class="px-4 pt-3 pb-2 text-[11px] flex items-center justify-between text-gray-400"><div><span class="like-count font-medium text-orange-400">128</span> likes</div><div>34 comments ¬∑ 9 shares</div></div><div class="h-px bg-white/10 mx-4"></div>
        <div class="flex px-2 py-1 text-[12px] font-medium">
          <button class="post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="thumbs-up" class="w-4 h-4"></i><span>Like</span></button>
          <button class="post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="message-square" class="w-4 h-4"></i><span>Comment</span></button>
          <button class="post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="share-2" class="w-4 h-4"></i><span>Share</span></button>
        </div>
      </article>
      
      <section class="bg-white/5 border border-white/10 backdrop-blur rounded-xl p-3">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold text-sm tracking-wide flex items-center gap-2"><i data-lucide="calendar" class="w-4 h-4 text-orange-400"></i>Upcoming Events on Campus</h2>
          <button id="openEventsList" class="text-[11px] text-orange-400 hover:underline">See all</button>
        </div>
        <div class="overflow-x-auto no-scrollbar -mx-1 px-1" style="-webkit-overflow-scrolling:touch;">
          <div class="flex space-x-3 w-max">
            <div class="cursor-pointer w-48 flex-shrink-0 bg-white/5 rounded-lg border border-white/10 overflow-hidden">
              <div class="h-24 w-full bg-center bg-cover" style="background-image:url('https://picsum.photos/id/10/300/200')"></div>
              <div class="p-2 space-y-1">
                <p class="text-xs font-semibold leading-tight">SRC Week: Bonfire Night</p>
                <p class="text-[10px] text-gray-400">Fri, Aug 29 ‚Ä¢ 8:00 PM</p>
                <button class="see-event w-full mt-1 bg-orange-600 hover:bg-orange-500 text-[10px] font-medium rounded px-1.5 py-1.5" data-event='{"title":"SRC Week: Bonfire Night","time":"Fri, Aug 29 ‚Ä¢ 8:00 PM","image":"https://picsum.photos/id/10/600/400","details":"Join us for an electrifying bonfire to kick off SRC Week with music, games and snacks!","contact":"+233 555 111 222","dm":"/Dm.html?u=src_week"}'>See Details</button>
              </div>
            </div>
            <div class="cursor-pointer w-48 flex-shrink-0 bg-white/5 rounded-lg border border-white/10 overflow-hidden">
              <div class="h-24 w-full bg-center bg-cover" style="background-image:url('https://picsum.photos/id/22/300/200')"></div>
              <div class="p-2 space-y-1">
                <p class="text-xs font-semibold leading-tight">CASFORD Hall Tech Summit</p>
                <p class="text-[10px] text-gray-400">Sat, Aug 30 ‚Ä¢ 10:00 AM</p>
                <button class="see-event w-full mt-1 bg-orange-600 hover:bg-orange-500 text-[10px] font-medium rounded px-1.5 py-1.5" data-event='{"title":"CASFORD Hall Tech Summit","time":"Sat, Aug 30 ‚Ä¢ 10:00 AM","image":"https://picsum.photos/id/22/600/400","details":"A day of tech talks, startup demos and networking hosted by CASFORD Hall.","contact":"+233 555 333 444","dm":"/Dm.html?u=casford_tech"}'>See Details</button>
              </div>
            </div>
            <div class="cursor-pointer w-48 flex-shrink-0 bg-white/5 rounded-lg border border-white/10 overflow-hidden">
                <div class="h-24 w-full bg-center bg-cover" style="background-image:url('https://picsum.photos/id/30/300/200')"></div>
                <div class="p-2 space-y-1">
                  <p class="text-xs font-semibold leading-tight">Valco Hall Movie Night</p>
                  <p class="text-[10px] text-gray-400">Sat, Aug 30 ‚Ä¢ 7:00 PM</p>
                  <button class="see-event w-full mt-1 bg-orange-600 hover:bg-orange-500 text-[10px] font-medium rounded px-1.5 py-1.5" data-event='{"title":"Valco Hall Movie Night","time":"Sat, Aug 30 ‚Ä¢ 7:00 PM","image":"https://picsum.photos/id/30/600/400","details":"Outdoor movie experience with popcorn and drinks provided by Valco Hall.","contact":"+233 555 777 999","dm":"/Dm.html?u=valco_movie"}'>See Details</button>
                </div>
              </div>
          </div>
        </div>
      </section>

      <article class="post bg-white/5 border border-purple-500/30 backdrop-blur rounded-xl overflow-hidden" data-post-id="ad-1">
        <div class="flex items-start gap-3 px-4 pt-4">
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-purple-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/seed/biz1/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
          <div class="flex-1">
            <div class="flex items-center justify-between">
                <div class="profile-link cursor-pointer">
                    <p class="text-sm font-semibold profile-link cursor-pointer">Campus Bites Eatery</p>
                    <p class="text-[11px] text-gray-400">Sponsored ¬∑ Near Science Market</p>
                </div>
                <span class="text-[10px] px-1.5 py-0.5 rounded-full bg-gray-400/20 text-gray-300">Ad</span>
            </div>
          </div>
        </div>
  <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200 theme-light:text-black">Hungry after lectures? Grab a delicious plate of Jollof for just GH‚Çµ20. We deliver to all halls!</div>
        <div class="mt-3 bg-black/30"><img src="https://picsum.photos/seed/jollof/600/400" alt="post media" class="w-full object-cover max-h-80"></div>
    <div class="p-3">
      <button class="ad-see-details w-full flex items-center justify-center gap-2 py-2 rounded-md bg-orange-600 hover:bg-orange-500 text-sm font-semibold transition" data-ad='{"title":"Campus Bites Eatery","tagline":"Hungry after lectures? Grab a delicious plate of Jollof for just GH‚Çµ20.","body":"Freshly prepared meals delivered to all halls within 15 minutes. We also cater for group orders and events.","price":"From GH‚Çµ20","image":"https://picsum.photos/seed/jollof/800/600","contact":["+233 555 222 888","campusbites@food.com"],"location":"Near Science Market","actionLink":"#order"}'>
        <span>See Details</span><i data-lucide="eye" class="w-4 h-4"></i>
      </button>
    </div>
      </article>

      <section class="bg-white/5 border border-white/10 backdrop-blur rounded-xl p-3">
        <div class="flex items-center justify-between mb-2"><h2 class="font-semibold text-sm tracking-wide">People you may know</h2><button class="text-[11px] text-orange-400 hover:underline">See all</button></div>
        <div class="overflow-x-auto no-scrollbar -mx-1 px-1" style="-webkit-overflow-scrolling:touch;">
          <div class="flex space-x-3 w-max">
            <div class="people-card cursor-pointer w-32 flex-shrink-0 bg-white/5 rounded-lg border border-white/10 overflow-hidden">
              <div class="h-24 w-full bg-center bg-cover" style="background-image:url('https://picsum.photos/id/1027/140/140')"></div>
              <div class="p-2 space-y-1"><p class="text-xs font-semibold leading-tight">Aisha Mensah</p><p class="text-[10px] text-gray-400">6 mutual friends</p><div class="flex gap-1 pt-1"><button class="flex-1 add-friend bg-orange-600 hover:bg-orange-500 text-[10px] font-medium rounded px-1.5 py-1">Add</button><button class="remove-card border border-white/20 hover:bg-white/10 rounded px-1.5 py-1 text-[10px]">X</button></div></div>
            </div>
            <div class="people-card cursor-pointer w-32 flex-shrink-0 bg-white/5 rounded-lg border border-white/10 overflow-hidden">
              <div class="h-24 w-full bg-center bg-cover" style="background-image:url('https://picsum.photos/id/1005/140/140')"></div>
              <div class="p-2 space-y-1"><p class="text-xs font-semibold leading-tight">Kwame Boateng</p><p class="text-[10px] text-gray-400">2 mutual friends</p><div class="flex gap-1 pt-1"><button class="flex-1 add-friend bg-orange-600 hover:bg-orange-500 text-[10px] font-medium rounded px-1.5 py-1">Add</button><button class="remove-card border border-white/20 hover:bg-white/10 rounded px-1.5 py-1 text-[10px]">X</button></div></div>
            </div>
          </div>
        </div>
      </section>

      <article class="post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden" data-post-id="3">
        <div class="flex items-start gap-3 px-4 pt-4">
            <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/id/1018/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
            <div class="flex-1"><p class="text-sm font-semibold profile-link cursor-pointer">Esi Nyarko</p><p class="text-[11px] text-gray-400">Yesterday ¬∑ Accra</p></div>
            <button class="p-1 text-gray-400 hover:text-white"><i data-lucide="ellipsis"></i></button>
        </div>
        <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200">Throwback to last weekend's beach cleanup! Proud of everyone who showed up. üåä‚ôªÔ∏è</div>
        <div class="mt-3 grid grid-cols-2 gap-1 px-4 pb-1">
            <img src="https://picsum.photos/id/1067/400/400" class="w-full h-32 object-cover rounded" alt="img1" />
            <img src="https://picsum.photos/id/1074/400/400" class="w-full h-32 object-cover rounded" alt="img2" />
        </div>
        <div class="px-4 pt-2 pb-2 text-[11px] flex items-center justify-between text-gray-400"><div><span class="like-count font-medium text-orange-400">302</span> likes</div><div>88 comments ¬∑ 21 shares</div></div><div class="h-px bg-white/10 mx-4"></div>
        <div class="flex px-2 py-1 text-[12px] font-medium">
            <button class="post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="thumbs-up" class="w-4 h-4"></i><span>Like</span></button>
            <button class="post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="message-square" class="w-4 h-4"></i><span>Comment</span></button>
            <button class="post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="share-2" class="w-4 h-4"></i><span>Share</span></button>
            <div class="hidden md:flex items-center gap-1 px-1" data-quick-react>
              <button data-react="üëç" class="text-xs opacity-70 hover:opacity-100">üëç</button>
              <button data-react="üòÇ" class="text-xs opacity-70 hover:opacity-100">üòÇ</button>
              <button data-react="üî•" class="text-xs opacity-70 hover:opacity-100">üî•</button>
              <button data-react="üéâ" class="text-xs opacity-70 hover:opacity-100">üéâ</button>
            </div>
        </div>
      </article>

      <!-- Additional static posts (added) -->
      <article class="post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden" data-post-id="4">
        <div class="flex items-start gap-3 px-4 pt-4">
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/id/1011/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
          <div class="flex-1"><p class="text-sm font-semibold profile-link cursor-pointer">Yaw Ofori</p><p class="text-[11px] text-gray-400">3 hrs ago ¬∑ Library</p></div>
          <button class="p-1 text-gray-400 hover:text-white"><i data-lucide="ellipsis"></i></button>
        </div>
        <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200">Grinding through revision. Anyone up for a late night study sprint? #StudyMode #Focus</div>
        <div class="px-4 pt-3 pb-2 text-[11px] flex items-center justify-between text-gray-400"><div><span class="like-count font-medium text-orange-400">54</span> likes</div><div>12 comments ¬∑ 2 shares</div></div><div class="h-px bg-white/10 mx-4"></div>
        <div class="flex px-2 py-1 text-[12px] font-medium">
          <button class="post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="thumbs-up" class="w-4 h-4"></i><span>Like</span></button>
          <button class="post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="message-square" class="w-4 h-4"></i><span>Comment</span></button>
          <button class="post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="share-2" class="w-4 h-4"></i><span>Share</span></button>
        </div>
      </article>

      <article class="post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden" data-post-id="5">
        <div class="flex items-start gap-3 px-4 pt-4">
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/id/1024/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
          <div class="flex-1"><p class="text-sm font-semibold profile-link cursor-pointer">Afua Serwaa</p><p class="text-[11px] text-gray-400">5 hrs ago ¬∑ Gym</p></div>
          <button class="p-1 text-gray-400 hover:text-white"><i data-lucide="ellipsis"></i></button>
        </div>
        <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200">Morning workout done ‚úÖ Feeling pumped! #Wellness #Discipline</div>
        <div class="mt-3 bg-black/30"><img src="https://picsum.photos/id/1025/600/400" alt="post media" class="w-full object-cover max-h-80" loading="lazy"></div>
        <div class="px-4 pt-3 pb-2 text-[11px] flex items-center justify-between text-gray-400"><div><span class="like-count font-medium text-orange-400">90</span> likes</div><div>15 comments ¬∑ 5 shares</div></div><div class="h-px bg-white/10 mx-4"></div>
        <div class="flex px-2 py-1 text-[12px] font-medium">
          <button class="post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="thumbs-up" class="w-4 h-4"></i><span>Like</span></button>
          <button class="post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="message-square" class="w-4 h-4"></i><span>Comment</span></button>
          <button class="post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="share-2" class="w-4 h-4"></i><span>Share</span></button>
        </div>
      </article>

      <article class="post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden" data-post-id="6">
        <div class="flex items-start gap-3 px-4 pt-4">
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/id/1035/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
          <div class="flex-1"><p class="text-sm font-semibold profile-link cursor-pointer">Campus Radio</p><p class="text-[11px] text-gray-400">6 hrs ago ¬∑ Studio</p></div>
          <button class="p-1 text-gray-400 hover:text-white"><i data-lucide="ellipsis"></i></button>
        </div>
        <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200">LIVE at 6pm: Panel on student innovation. Drop questions below! #Innovation #Tech</div>
        <div class="px-4 pt-3 pb-2 text-[11px] flex items-center justify-between text-gray-400"><div><span class="like-count font-medium text-orange-400">41</span> likes</div><div>23 comments ¬∑ 3 shares</div></div><div class="h-px bg-white/10 mx-4"></div>
        <div class="flex px-2 py-1 text-[12px] font-medium">
          <button class="post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="thumbs-up" class="w-4 h-4"></i><span>Like</span></button>
          <button class="post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="message-square" class="w-4 h-4"></i><span>Comment</span></button>
          <button class="post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="share-2" class="w-4 h-4"></i><span>Share</span></button>
        </div>
      </article>

      <article class="post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden" data-post-id="7">
        <div class="flex items-start gap-3 px-4 pt-4">
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/id/1047/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
          <div class="flex-1"><p class="text-sm font-semibold profile-link cursor-pointer">Design Club</p><p class="text-[11px] text-gray-400">8 hrs ago ¬∑ Lab 2</p></div>
          <button class="p-1 text-gray-400 hover:text-white"><i data-lucide="ellipsis"></i></button>
        </div>
        <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200">Prototype session tonight. Bring your Figma drafts! #UI #Creativity #Growth</div>
        <div class="mt-3 grid grid-cols-3 gap-1 px-4 pb-1">
          <img src="https://picsum.photos/id/1048/300/300" class="w-full h-20 object-cover rounded" alt="d1" />
          <img src="https://picsum.photos/id/1050/300/300" class="w-full h-20 object-cover rounded" alt="d2" />
          <img src="https://picsum.photos/id/1052/300/300" class="w-full h-20 object-cover rounded" alt="d3" />
        </div>
        <div class="px-4 pt-2 pb-2 text-[11px] flex items-center justify-between text-gray-400"><div><span class="like-count font-medium text-orange-400">67</span> likes</div><div>19 comments ¬∑ 4 shares</div></div><div class="h-px bg-white/10 mx-4"></div>
        <div class="flex px-2 py-1 text-[12px] font-medium">
          <button class="post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="thumbs-up" class="w-4 h-4"></i><span>Like</span></button>
          <button class="post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="message-square" class="w-4 h-4"></i><span>Comment</span></button>
          <button class="post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="share-2" class="w-4 h-4"></i><span>Share</span></button>
        </div>
      </article>

      <article class="post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden" data-post-id="8">
        <div class="flex items-start gap-3 px-4 pt-4">
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/id/1056/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
          <div class="flex-1"><p class="text-sm font-semibold profile-link cursor-pointer">Mimi Osei</p><p class="text-[11px] text-gray-400">10 hrs ago ¬∑ Hostel</p></div>
          <button class="p-1 text-gray-400 hover:text-white"><i data-lucide="ellipsis"></i></button>
        </div>
        <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200">Late-night brainstorming turned into snack time üòÖ #Hustle #CampusLife</div>
        <div class="mt-3 bg-black/30"><img src="https://picsum.photos/id/1057/600/400" alt="post media" class="w-full object-cover max-h-80" loading="lazy"></div>
        <div class="px-4 pt-3 pb-2 text-[11px] flex items-center justify-between text-gray-400"><div><span class="like-count font-medium text-orange-400">120</span> likes</div><div>40 comments ¬∑ 6 shares</div></div><div class="h-px bg-white/10 mx-4"></div>
        <div class="flex px-2 py-1 text-[12px] font-medium">
          <button class="post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="thumbs-up" class="w-4 h-4"></i><span>Like</span></button>
          <button class="post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="message-square" class="w-4 h-4"></i><span>Comment</span></button>
          <button class="post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="share-2" class="w-4 h-4"></i><span>Share</span></button>
        </div>
      </article>

      <article class="post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden" data-post-id="9">
        <div class="flex items-start gap-3 px-4 pt-4">
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/id/1062/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
          <div class="flex-1"><p class="text-sm font-semibold profile-link cursor-pointer">Dept. of Engineering</p><p class="text-[11px] text-gray-400">Yesterday ¬∑ Lab Block</p></div>
          <button class="p-1 text-gray-400 hover:text-white"><i data-lucide="ellipsis"></i></button>
        </div>
        <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200">Capstone teams showcase tomorrow. Come support and network! #Engineering #Projects</div>
        <div class="px-4 pt-3 pb-2 text-[11px] flex items-center justify-between text-gray-400"><div><span class="like-count font-medium text-orange-400">76</span> likes</div><div>18 comments ¬∑ 11 shares</div></div><div class="h-px bg-white/10 mx-4"></div>
        <div class="flex px-2 py-1 text-[12px] font-medium">
          <button class="post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="thumbs-up" class="w-4 h-4"></i><span>Like</span></button>
          <button class="post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="message-square" class="w-4 h-4"></i><span>Comment</span></button>
          <button class="post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="share-2" class="w-4 h-4"></i><span>Share</span></button>
        </div>
      </article>

      <article class="post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden" data-post-id="10">
        <div class="flex items-start gap-3 px-4 pt-4">
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link profile-link cursor-pointer"><img src="https://picsum.photos/id/1070/80/80" alt="avatar" class="w-full h-full object-cover" /></div>
          <div class="flex-1"><p class="text-sm font-semibold profile-link cursor-pointer">Kojo Mensah</p><p class="text-[11px] text-gray-400">2 days ago ¬∑ Off Campus</p></div>
          <button class="p-1 text-gray-400 hover:text-white"><i data-lucide="ellipsis"></i></button>
        </div>
        <div class="px-4 pt-3 text-sm leading-relaxed text-gray-200">Weekend recharge with nature üåø #Balance #Wellbeing</div>
        <div class="mt-3 bg-black/30"><img src="https://picsum.photos/id/1072/600/400" alt="post media" class="w-full object-cover max-h-80" loading="lazy"></div>
        <div class="px-4 pt-3 pb-2 text-[11px] flex items-center justify-between text-gray-400"><div><span class="like-count font-medium text-orange-400">133</span> likes</div><div>25 comments ¬∑ 7 shares</div></div><div class="h-px bg-white/10 mx-4"></div>
        <div class="flex px-2 py-1 text-[12px] font-medium">
          <button class="post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="thumbs-up" class="w-4 h-4"></i><span>Like</span></button>
          <button class="post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="message-square" class="w-4 h-4"></i><span>Comment</span></button>
          <button class="post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition"><i data-lucide="share-2" class="w-4 h-4"></i><span>Share</span></button>
        </div>
      </article>

    </div>
  </main>
  
  <div id="composerModal" class="fixed inset-0 z-[1000] hidden" aria-hidden="true">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
    <div class="absolute inset-x-0 top-0 mx-auto w-full max-w-sm p-4 animate-fade-in">
      <div class="bg-white/10 border border-white/20 rounded-2xl shadow-xl overflow-hidden flex flex-col max-h-[90vh]">
        <div class="flex items-center justify-between px-4 py-3 border-b border-white/10">
          <h3 class="text-sm font-semibold">Create Post</h3>
          <button id="closeComposer" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="Close create post"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="p-4 space-y-4 overflow-y-auto">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500"><img src="https://picsum.photos/id/1019/80/80" class="w-full h-full object-cover" alt="avatar" /></div>
            <div>
              <p class="text-sm font-semibold">You</p>
              <select class="bg-black/30 text-xs px-2 py-1 rounded border border-white/10 focus:outline-none"><option>Friends</option><option>Only Me</option><option>Public</option></select>
            </div>
          </div>
          <div class="space-y-1">
            <textarea id="composerText" rows="4" placeholder="What's on your mind?" class="w-full bg-black/30 rounded-lg p-3 text-sm resize-none focus:outline-none placeholder-gray-400" maxlength="400"></textarea>
            <div class="flex items-center justify-between text-[11px] px-1">
              <span id="draftStatus" class="text-green-400 opacity-0 transition-opacity">Saved</span>
              <span id="charCounter" class="text-white/50"><span id="charUsed">0</span>/280</span>
            </div>
          </div>
          <div id="mediaPreview" class="hidden"></div>
          <div class="flex gap-2 flex-wrap">
            <button id="addPhotoBtn" class="flex items-center gap-1 text-xs px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10"><i data-lucide="image" class="w-4 h-4"></i>Photo/Video</button>
            <button class="flex items-center gap-1 text-xs px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10"><i data-lucide="calendar-plus" class="w-4 h-4"></i>Create Event</button>
            <button class="flex items-center gap-1 text-xs px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10"><i data-lucide="map-pin" class="w-4 h-4"></i>Check in</button>
          </div>
        </div>
        <div class="p-4 border-t border-white/10">
          <button id="postSubmit" class="w-full py-2 rounded-lg bg-orange-600 hover:bg-orange-500 font-medium text-sm disabled:opacity-40 disabled:cursor-not-allowed">Post</button>
        </div>
      </div>
    </div>
  </div>

  <div id="shareModal" class="fixed inset-0 z-[998] hidden"><div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div><div class="absolute inset-x-0 top-0 mx-auto w-full max-w-sm p-4 animate-fade-in"><div class="bg-white/10 border border-white/20 rounded-2xl p-5 shadow-xl relative space-y-4"><div class="flex items-center justify-between"><h3 class="text-sm font-semibold">Share Post</h3><button id="closeShare" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="Close share"><i data-lucide="x" class="w-5 h-5"></i></button></div><div class="grid grid-cols-3 gap-3 text-center text-[11px]"><button class="share-action flex flex-col items-center gap-2 p-3 rounded-lg bg-white/5 hover:bg-white/10" data-action="feed"><i data-lucide="rss" class="w-5 h-5"></i><span>Feed</span></button><button class="share-action flex flex-col items-center gap-2 p-3 rounded-lg bg-white/5 hover:bg-white/10" data-action="story"><i data-lucide="circle" class="w-5 h-5"></i><span>Story</span></button><button class="share-action flex flex-col items-center gap-2 p-3 rounded-lg bg-white/5 hover:bg-white/10" data-action="message"><i data-lucide="send" class="w-5 h-5"></i><span>Message</span></button><button class="col-span-3 share-copy flex items-center justify-center gap-2 w-full py-2 rounded-lg bg-orange-600 hover:bg-orange-500 text-sm font-medium"><i data-lucide="link" class="w-4 h-4"></i><span>Copy Link</span></button></div><p id="shareStatus" class="text-center text-[11px] text-green-400 hidden">Link copied!</p></div></div></div>
  <div id="searchModal" class="fixed inset-0 z-[999] hidden"><div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div><div class="absolute inset-x-0 top-0 mx-auto w-full max-w-sm p-4 animate-fade-in"><div class="bg-white/10 border border-white/20 rounded-2xl p-4 shadow-xl relative"><div class="flex items-center gap-2"><i data-lucide="search" class="w-5 h-5 text-gray-300"></i><input id="searchInputModal" type="text" placeholder="Search..." class="flex-1 bg-transparent outline-none text-sm placeholder-gray-400" /><button id="closeSearch" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="Close search"><i data-lucide="x" class="w-5 h-5"></i></button></div><div id="searchResults" class="mt-4 max-h-72 overflow-y-auto space-y-2 text-sm"></div><div id="searchEmpty" class="mt-6 text-center text-xs text-gray-400">Type to start searching</div></div></div></div>
  <style>@keyframes fade-in {from{opacity:0; transform:translateY(-8px);} to{opacity:1; transform:translateY(0);} } .animate-fade-in { animation: fade-in .25s ease; } .no-scroll { overflow: hidden !important; }</style>

  <!-- Event Details Modal -->
  <div id="eventModal" class="fixed inset-0 z-[1002] hidden" role="dialog" aria-modal="true" aria-labelledby="evTitle">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" aria-hidden="true"></div>
    <div class="absolute inset-x-0 top-0 mx-auto w-full max-w-sm p-4 animate-fade-in">
      <div class="bg-white/10 border border-white/20 rounded-2xl shadow-xl overflow-hidden flex flex-col max-h-[92vh]">
        <div class="flex items-center justify-between px-4 py-3 border-b border-white/10">
          <h3 id="evTitle" class="text-sm font-semibold">Event</h3>
          <button id="closeEvent" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="Close event"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="overflow-y-auto">
          <div id="evImage" class="w-full h-48 bg-center bg-cover"></div>
          <div class="p-4 space-y-3">
            <p id="evTime" class="text-[11px] text-gray-400"></p>
            <p id="evLocation" class="text-[11px] text-gray-400 hidden"></p>
            <p id="evDetails" class="text-sm leading-relaxed text-gray-200"></p>
            <div id="evContactsWrap" class="bg-white/5 border border-white/10 rounded-lg p-3 text-[12px] space-y-2">
              <div id="evContactsList" class="space-y-1"></div>
              <button id="evDm" class="w-full py-2 rounded-lg bg-orange-600 hover:bg-orange-500 text-sm font-medium flex items-center gap-2 justify-center"><i data-lucide="send" class="w-4 h-4 -rotate-45"></i><span>DM Organizer</span></button>
            </div>
          </div>
        </div>
        <div class="p-4 border-t border-white/10 flex gap-2">
          <button id="evShare" class="flex-1 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-sm font-medium flex items-center justify-center gap-2"><i data-lucide="share-2" class="w-4 h-4"></i>Share</button>
          <button id="evCloseBottom" class="flex-1 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-sm font-medium">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ad Details Modal -->
  <div id="adModal" class="fixed inset-0 z-[1003] hidden" role="dialog" aria-modal="true" aria-labelledby="adTitle">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" aria-hidden="true"></div>
    <div class="absolute inset-x-0 top-0 mx-auto w-full max-w-sm p-4 animate-fade-in">
      <div class="bg-white/10 border border-white/20 rounded-2xl shadow-xl overflow-hidden flex flex-col max-h-[92vh]">
        <div class="flex items-center justify-between px-4 py-3 border-b border-white/10">
          <h3 id="adTitle" class="text-sm font-semibold">Ad</h3>
          <button id="closeAd" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="Close ad"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="overflow-y-auto">
          <div id="adImage" class="w-full h-48 bg-center bg-cover"></div>
          <div class="p-4 space-y-3">
            <p id="adTag" class="text-[11px] text-orange-300"></p>
            <p id="adBody" class="text-sm leading-relaxed text-gray-200"></p>
            <p id="adPrice" class="text-xs font-medium text-gray-300"></p>
            <p id="adLocation" class="text-[11px] text-gray-400"></p>
            <div id="adContacts" class="space-y-1"></div>
            <button id="adAction" class="w-full py-2 rounded-lg bg-orange-600 hover:bg-orange-500 text-sm font-medium flex items-center gap-2 justify-center hidden"><i data-lucide="send" class="w-4 h-4 -rotate-45"></i><span>DM</span></button>
          </div>
        </div>
        <div class="p-4 border-t border-white/10 flex gap-2">
          <button id="adShare" class="flex-1 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-sm font-medium flex items-center justify-center gap-2"><i data-lucide="share-2" class="w-4 h-4"></i>Share</button>
          <button id="adCloseBottom" class="flex-1 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-sm font-medium">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Media Viewer Modal -->
  <div id="mediaViewer" class="fixed inset-0 z-[1100] hidden" role="dialog" aria-modal="true" aria-label="Media viewer">
    <div class="absolute inset-0 bg-black/90 backdrop-blur-sm"></div>
    <div class="absolute inset-0 flex flex-col">
      <div class="flex items-center justify-between px-3 py-2 text-xs text-gray-300">
        <button id="mediaClose" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="Close media"><i data-lucide="x" class="w-5 h-5"></i></button>
        <div id="mediaCounter" class="font-medium hidden"></div>
        <div class="flex items-center gap-2">
          <button id="mediaDownload" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10" aria-label="Download"><i data-lucide="download" class="w-5 h-5"></i></button>
          <button id="mediaPrev" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10 disabled:opacity-30" aria-label="Previous"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
          <button id="mediaNext" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10 disabled:opacity-30" aria-label="Next"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
        </div>
      </div>
      <div class="flex-1 flex items-center justify-center px-4 pb-6">
        <div id="mediaStage" class="relative max-w-full max-h-full flex items-center justify-center touch-pan-y overflow-hidden"></div>
      </div>
    </div>
  </div>

  <script>
  lucide.createIcons();

    // Sidebar Logic
  // sidebar logic handled by shared-ui.js

    // Interaction logic
    document.addEventListener('click', (e)=>{
      const likeBtn = e.target.closest('.post-like');
      if(likeBtn){
        const post = likeBtn.closest('.post');
        const countEl = post.querySelector('.like-count');
        let count = parseInt(countEl.textContent,10);
        const active = likeBtn.classList.toggle('text-orange-400');
        likeBtn.classList.toggle('font-semibold', active);
        likeBtn.querySelector('i')?.classList.toggle('fill-orange-500');
        count += active ? 1 : -1;
        if(count < 0) count = 0;
        countEl.textContent = count;
        return;
      }
      if(e.target.closest('.post-comment')){ window.location.href='comments.html'; return; }
      if(e.target.closest('.post-share')){ openShareModal(); return; }
      const addFriend = e.target.closest('.add-friend');
      if(addFriend){
        addFriend.textContent = 'Added';
        addFriend.disabled = true;
        addFriend.classList.remove('bg-orange-600','hover:bg-orange-500');
        addFriend.classList.add('bg-green-600');
        return;
      }
      const removeCard = e.target.closest('.remove-card');
      if(removeCard){ removeCard.closest('.w-32')?.remove(); return; }
      if(e.target.closest('.people-card') && !e.target.closest('button')){ window.location.href='PeopleProfile.html'; return; }
      const postArticle = e.target.closest('article.post');
      // Restrict navigation to explicit profile link areas (avatar image wrapper or name element with .profile-link)
      if(postArticle && !e.target.closest('button')){
        const profileTrigger = e.target.closest('.profile-link, .avatar-link');
        if(profileTrigger){ window.location.href='PeopleProfile.html'; return; }
      }
    });

    // Modal Scripts (Share, Composer, Search)...
    function openShareModal(){ document.getElementById('shareModal').classList.remove('hidden'); document.body.classList.add('no-scroll'); lucide.createIcons(); }
    function closeShareModal(){ document.getElementById('shareModal').classList.add('hidden'); document.body.classList.remove('no-scroll'); document.getElementById('shareStatus').classList.add('hidden');}
    document.addEventListener('click', e=>{ if(e.target.id==='closeShare' || e.target.id==='shareModal') closeShareModal(); const action = e.target.closest('.share-action'); if(action){ closeShareModal(); alert('Shared via '+ action.dataset.action); } if(e.target.closest('.share-copy')){ navigator.clipboard?.writeText(window.location.href); const status = document.getElementById('shareStatus'); status.classList.remove('hidden'); setTimeout(()=> status.classList.add('hidden'), 2000); } });
    (function(){
      const modal=document.getElementById('composerModal');
      const closeBtn=document.getElementById('closeComposer');
      const fileInput=document.getElementById('composerFile');
      const addPhotoBtn=document.getElementById('addPhotoBtn');
      const mediaBtn=document.getElementById('composerMediaBtn');
      const preview=document.getElementById('mediaPreview');
  const textArea=document.getElementById('composerText');
  const submit=document.getElementById('postSubmit');
  const charUsedEl=document.getElementById('charUsed');
  const draftStatus=document.getElementById('draftStatus');
  const hardLimit=400; const softLimit=280; const warnAt=260;
      function open(){ if(!modal) return; modal.classList.remove('hidden'); document.body.classList.add('no-scroll'); // restore draft
        const draft=window.PairedData?.getDraft?.(); if(draft){ if(textArea) textArea.value=draft.text||''; if(draft.media && preview){ preview.innerHTML=''; draft.media.forEach(src=>{ const img=document.createElement('img'); img.src=src; img.className='w-full h-32 object-cover rounded-lg'; preview.appendChild(img); }); if(draft.media.length){ preview.classList.remove('hidden'); preview.classList.add('grid','grid-cols-2','gap-2'); } } }
        textArea?.focus(); if(window.lucide) lucide.createIcons(); updateState(); }
  function close(){ if(!modal) return; modal.classList.add('hidden'); document.body.classList.remove('no-scroll'); if(textArea) textArea.value=''; if(preview){
        try { const urls=JSON.parse(preview.dataset.objectUrls||'[]'); urls.forEach(u=> URL.revokeObjectURL(u)); }catch(e){}
        preview.innerHTML=''; preview.className='hidden'; delete preview.dataset.objectUrls; } if(fileInput) fileInput.value=''; window.PairedData?.clearDraft?.(); updateState(); }
      function updateState(){
        if(!submit) return;
        const txt=textArea?textArea.value:"";
        const used=txt.length;
        if(charUsedEl) charUsedEl.textContent=used;
        // visual warn
        const counterWrap=document.getElementById('charCounter');
        if(counterWrap){
          counterWrap.classList.toggle('text-orange-400', used>=warnAt && used<=softLimit);
          counterWrap.classList.toggle('text-red-500', used>softLimit);
        }
        submit.disabled=!(txt.trim()) || used>softLimit;
      }
      let draftTimer; let saveTimer;
      function wireOpenField(){
        const openField=document.getElementById('openComposerModal');
        if(!openField){ setTimeout(wireOpenField,80); return; }
        openField.addEventListener('click', open);
      }
      wireOpenField();
      closeBtn?.addEventListener('click', close);
      modal?.addEventListener('click', e=>{ if(e.target===modal) close(); });
      addPhotoBtn?.addEventListener('click', ()=> fileInput?.click());
      mediaBtn?.addEventListener('click', ()=> fileInput?.click());
      fileInput?.addEventListener('change', ()=>{
        if(!preview || !fileInput) return;
        preview.innerHTML='';
        const files=Array.from(fileInput.files||[]).slice(0,4);
        if(files.length){ preview.classList.remove('hidden'); preview.classList.add('grid','grid-cols-2','gap-2'); }
  const createdUrls=[]; files.forEach(f=>{ const url=URL.createObjectURL(f); createdUrls.push(url); const el=document.createElement(f.type.startsWith('video')?'video':'img'); el.src=url; if(el.tagName!=='VIDEO') el.loading='lazy'; el.className='w-full h-32 object-cover rounded-lg'; if(el.tagName==='VIDEO') el.controls=true; preview.appendChild(el); }); preview.dataset.objectUrls=JSON.stringify(createdUrls);
        updateState();
      });
      textArea?.addEventListener('input', ()=>{ updateState();
        clearTimeout(draftTimer);
        draftTimer=setTimeout(()=>{
          window.PairedData?.saveDraft?.({ text:textArea.value.trim(), media:[...preview.querySelectorAll('img')].map(i=>i.src).slice(0,4) });
          if(draftStatus){ draftStatus.classList.remove('opacity-0'); draftStatus.textContent='Saved'; clearTimeout(saveTimer); saveTimer=setTimeout(()=> draftStatus.classList.add('opacity-0'),1500); }
        },400);
      });
      submit?.addEventListener('click', ()=>{
        const posts=document.getElementById('posts');
        if(!posts) return;
        const mediaHTML=preview?Array.from(preview.children).map(c=> c.tagName==='IMG'?`<img src="${c.src}" class='w-full object-cover max-h-80'>`:`<video src='${c.src}' class='w-full max-h-80' controls></video>`).join(''):'';
        const newPost=document.createElement('article');
        newPost.className='post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden';
        newPost.innerHTML=`<div class='flex items-start gap-3 px-4 pt-4'>
  <div class='w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500 avatar-link cursor-pointer profile-link'><img src='https://picsum.photos/id/1019/80/80' class='w-full h-full object-cover'/></div>
  <div class='flex-1'>
    <p class='text-sm font-semibold profile-link cursor-pointer'>You</p>
    <p class='text-[11px] text-gray-400'>Just now ¬∑ Mobile</p>
  </div>
  <button class='p-1 text-gray-400 hover:text-white post-options-trigger'><i data-lucide="ellipsis"></i></button>
</div>
<div class='px-4 pt-3 text-sm leading-relaxed text-gray-200'></div>
${mediaHTML?`<div class='mt-3 bg-black/30 media-block'>${mediaHTML}</div>`:''}
<div class='px-4 pt-3 pb-2 text-[11px] flex items-center justify-between text-gray-400'><div><span class='like-count font-medium text-orange-400'>0</span> likes</div><div>0 comments ¬∑ 0 shares</div></div>
<div class='h-px bg-white/10 mx-4'></div>
<div class='flex px-2 py-1 text-[12px] font-medium'>
  <button class='post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition'><i data-lucide='thumbs-up' class='w-4 h-4'></i><span>Like</span></button>
  <button class='post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition'><i data-lucide='message-square' class='w-4 h-4'></i><span>Comment</span></button>
  <button class='post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition'><i data-lucide='share-2' class='w-4 h-4'></i><span>Share</span></button>
</div>`;
    const bodyEl=newPost.querySelector('.px-4.pt-3.text-sm');
    if(bodyEl && textArea){ bodyEl.innerHTML=parseTextContent(textArea.value.trim()); }
    // add bookmark button
    const actions=newPost.querySelector('.flex.px-2.py-1');
    if(actions){ const bm=document.createElement('button'); bm.className='post-bookmark flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition'; bm.innerHTML="<i data-lucide='bookmark' class='w-4 h-4'></i><span>Save</span>"; actions.appendChild(bm); }
        posts.prepend(newPost);
        if(window.lucide) lucide.createIcons();
        close();
      });
      // Infinite scroll (single implementation) ‚Äî buffered prefetch + anchored flush (no jump / preserve current view)
      (function(){
        const postsWrap=document.getElementById('posts');
        const skel=document.getElementById('feedSkeleton');
        if(!postsWrap) return;
        let page=1; let loading=false; let done=false; let buffer=[]; let prefetching=false; let firstLoad=true;
        const sentinel=document.createElement('div');
        sentinel.id='scrollSentinel';
        sentinel.className='h-12 flex items-center justify-center text-[11px] text-gray-400 select-none';
        sentinel.setAttribute('role','status');
        sentinel.textContent='';
        postsWrap.appendChild(sentinel);
        function fakeFetch(pageNum){
          return new Promise(res=>{ setTimeout(()=>{
            if(pageNum>12) return res([]);
            const arr=Array.from({length:4}).map((_,i)=>({ id:'dyn-'+pageNum+'-'+i, body:`Autoloaded content page ${pageNum} item ${i} #Growth`, media:(i%2===0)}));
            res(arr);
          },550); });
        }
        function renderOne(p,beforeEl){
          const el=document.createElement('article');
          el.className='post bg-white/5 border border-white/10 backdrop-blur rounded-xl overflow-hidden will-change-transform';
          el.setAttribute('data-post-id', p.id);
          el.innerHTML=`<div class='flex items-start gap-3 px-4 pt-4'>
            <div class='w-10 h-10 rounded-full overflow-hidden border-2 border-orange-500'><img src='https://picsum.photos/seed/${encodeURIComponent(p.id)}/80/80' class='w-full h-full object-cover'/></div>
            <div class='flex-1'><p class='text-sm font-semibold'>Auto User</p><p class='text-[11px] text-gray-400'>Just now ¬∑ Auto</p></div>
            <button class='p-1 text-gray-400 hover:text-white post-options-trigger'><i data-lucide="ellipsis"></i></button>
          </div>
          <div class='px-4 pt-3 text-sm leading-relaxed text-gray-200'></div>
          ${p.media?`<div class='mt-3 bg-black/30 media-block'><img src='https://picsum.photos/seed/${encodeURIComponent(p.id)}/600/400' class='w-full object-cover max-h-80' loading='lazy'></div>`:''}
          <div class='px-4 pt-3 pb-2 text-[11px] flex items-center justify-between text-gray-400'><div><span class='like-count font-medium text-orange-400'>0</span> likes</div><div>0 comments ¬∑ 0 shares</div></div>
          <div class='h-px bg-white/10 mx-4'></div>
          <div class='flex px-2 py-1 text-[12px] font-medium'>
            <button class='post-like flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition'><i data-lucide='thumbs-up' class='w-4 h-4'></i><span>Like</span></button>
            <button class='post-comment flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition'><i data-lucide='message-square' class='w-4 h-4'></i><span>Comment</span></button>
            <button class='post-share flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition'><i data-lucide='share-2' class='w-4 h-4'></i><span>Share</span></button>
            <button class='post-bookmark flex-1 flex items-center justify-center gap-1 py-2 rounded-md hover:bg-white/10 transition'><i data-lucide='bookmark' class='w-4 h-4'></i><span>Save</span></button>
          </div>`;
          const body=el.querySelector('.px-4.pt-3.text-sm'); if(body) body.innerHTML=parseTextContent(p.body); (beforeEl||sentinel).before(el);
        }
  function flushBuffer(){
          if(!buffer.length) return;
          const items=buffer.splice(0);
          // Capture anchor (sentinel) top BEFORE insertion
          const anchorTop=sentinel.getBoundingClientRect().top + window.scrollY;
          items.forEach(p=>renderOne(p));
          if(window.lucide) lucide.createIcons();
          // Maintain scroll position so currently viewed post stays fixed
          requestAnimationFrame(()=>{
            const newTop=sentinel.getBoundingClientRect().top + window.scrollY;
            const delta=newTop - anchorTop;
            if(Math.abs(delta)>2) window.scrollBy(0, delta);
            // Remove will-change after paint to free memory
            requestAnimationFrame(()=>{
              postsWrap.querySelectorAll('article.will-change-transform').forEach(a=> a.classList.remove('will-change-transform'));
            });
          });
        }
        async function prefetch(){
          if(prefetching||done) return;
          prefetching=true;
          sentinel.textContent = firstLoad? '' : 'Loading‚Ä¶';
          const data=await fakeFetch(page+1);
          if(!data.length){ done=true; sentinel.textContent='No more posts'; prefetching=false; return; }
          page+=1; buffer.push(...data); prefetching=false; sentinel.textContent='';
        }
        async function maybeAppend(){
          if(done) return;
          const distance=sentinel.getBoundingClientRect().top - window.innerHeight;
          if(distance < 350){
            if(!buffer.length && !loading){
              loading=true;
              if(firstLoad){ skel?.classList.remove('hidden'); }
              await prefetch();
              if(firstLoad){ skel?.classList.add('hidden'); firstLoad=false; }
              loading=false;
            }
            flushBuffer();
            // opportunistic prefetch of next page (idle/yield)
            if('requestIdleCallback' in window) requestIdleCallback(()=> prefetch(), { timeout:800 }); else setTimeout(()=> prefetch(), 100);
          }
        }
        document.addEventListener('scroll', maybeAppend, { passive:true });
        prefetch().then(()=>{ flushBuffer(); if(window.lucide) lucide.createIcons(); });
        const io=new IntersectionObserver(()=> maybeAppend(), {rootMargin:'420px'}); io.observe(sentinel);
      })();
      // Ensure body top padding matches inline header (prevent content underlap if script order changed)
      (function(){ const ui=document.getElementById('fixed-ui'); if(ui){ const h=ui.getBoundingClientRect().height; const cur=parseInt(getComputedStyle(document.body).paddingTop)||0; if(Math.abs(cur-h)>2) document.body.style.paddingTop=h+'px'; }})();
  // (Removed corrupted ad modal duplicate block during infinite scroll refactor)
    // Media Viewer Logic
    (function(){
      const viewer=document.getElementById('mediaViewer');
      const stage=document.getElementById('mediaStage');
      const closeBtn=document.getElementById('mediaClose');
      const prevBtn=document.getElementById('mediaPrev');
      const nextBtn=document.getElementById('mediaNext');
      const downloadBtn=document.getElementById('mediaDownload');
      const counter=document.getElementById('mediaCounter');
      let list=[]; let index=0;
      let scale=1, baseScale=1, startDist=0, originX=0, originY=0, translateX=0, translateY=0, startX=0, startY=0, isPanning=false;
    function render(){
        stage.innerHTML='';
        if(!list.length){ return; }
        const item=list[index];
        let el;
        if(item.type==='video'){
          el=document.createElement('video');
          el.src=item.src; el.controls=true; el.className='max-h-[82vh] max-w-full rounded-lg shadow-lg';
        } else {
          el=document.createElement('img');
      el.src=item.src; el.alt=item.alt||''; el.loading='lazy'; el.className='max-h-[82vh] max-w-full object-contain rounded-lg shadow-lg select-none';
        }
        stage.appendChild(el);
        if(list.length>1){
          counter.textContent=`${index+1} / ${list.length}`;
          counter.classList.remove('hidden');
        } else counter.classList.add('hidden');
        prevBtn.disabled = index===0;
        nextBtn.disabled = index===list.length-1;
        if(window.lucide) lucide.createIcons();
        resetTransforms();
        updateDownload();
      }
  let lastFocus=null;
  function open(newList,start){ list=newList; index=start||0; viewer.classList.remove('hidden'); document.body.classList.add('no-scroll'); lastFocus=document.activeElement; render(); trapFocus(); }
      function close(){ viewer.classList.add('hidden'); document.body.classList.remove('no-scroll'); stage.innerHTML=''; list=[]; }
      function resetTransforms(){ scale=1; baseScale=1; translateX=0; translateY=0; applyTransform(); }
      function applyTransform(){ const el=stage.querySelector('img:not([style*="display:none"])'); if(!el) return; el.style.transform=`translate(${translateX}px, ${translateY}px) scale(${scale})`; el.style.transition='transform 0s'; }
      function updateDownload(){ if(!downloadBtn) return; const item=list[index]; if(!item){ downloadBtn.disabled=true; return;} downloadBtn.disabled=false; downloadBtn.dataset.src=item.src; }
      prevBtn.addEventListener('click', ()=>{ if(index>0){ index--; render(); }});
      nextBtn.addEventListener('click', ()=>{ if(index<list.length-1){ index++; render(); }});
      closeBtn.addEventListener('click', close);
      // Only close if backdrop (first child) clicked, ignore clicks on stage content
      viewer.addEventListener('click', e=>{ if(e.target===viewer || e.target===viewer.firstElementChild) close(); });
      document.addEventListener('keydown', e=>{ if(viewer.classList.contains('hidden')) return; if(e.key==='Escape') close(); else if(e.key==='ArrowLeft') prevBtn.click(); else if(e.key==='ArrowRight') nextBtn.click(); });
      function gatherMedia(postEl){
        const mediaContainer = postEl.querySelector('.media-block') || postEl; // fallback
        const imgs=[...mediaContainer.querySelectorAll('img')].map(img=>({type:'img', src:img.currentSrc || img.src, alt:img.alt||''}));
        const vids=[...mediaContainer.querySelectorAll('video')].map(v=>({type:'video', src:v.currentSrc || v.src}));
        return [...imgs, ...vids];
      }
      document.addEventListener('click', e=>{
        const img=e.target.closest('img');
        if(!img) return;
        const post = img.closest('article.post');
        if(!post) return;
        // ignore clicks on avatars
        if(img.closest('.w-10.h-10') || img.closest('.w-7.h-7')) return;
        const mediaList=gatherMedia(post);
        const startIndex=mediaList.findIndex(m=>m.src=== (img.currentSrc||img.src));
        if(mediaList.length){ open(mediaList, startIndex<0?0:startIndex); }
      });
      // Pointer / touch gestures for pinch zoom & pan
      let pointers=new Map();
      function getPrimaryImage(){ return stage.querySelector('img'); }
      function distance(a,b){ return Math.hypot(a.clientX-b.clientX, a.clientY-b.clientY); }
      function center(a,b){ return { x:(a.clientX+b.clientX)/2, y:(a.clientY+b.clientY)/2 }; }
      function onPointerDown(e){ const img=getPrimaryImage(); if(!img) return; pointers.set(e.pointerId,e); img.setPointerCapture?.(e.pointerId); isPanning=true; startX=e.clientX; startY=e.clientY; }
      function onPointerMove(e){ const img=getPrimaryImage(); if(!img || !pointers.has(e.pointerId)) return; pointers.set(e.pointerId,e); if(pointers.size===2){ const [p1,p2]=[...pointers.values()]; const dist=distance(p1,p2); if(!startDist){ startDist=dist; baseScale=scale; const c=center(p1,p2); const rect=img.getBoundingClientRect(); originX=c.x - rect.left; originY=c.y - rect.top; } else { const factor=dist/startDist; scale=Math.min(Math.max(baseScale*factor,1),5); applyTransform(); } }
        else if(pointers.size===1 && scale>1 && isPanning){ const dx=e.clientX-startX; const dy=e.clientY-startY; startX=e.clientX; startY=e.clientY; translateX+=dx; translateY+=dy; applyTransform(); }
      }
      function onPointerUp(e){ if(pointers.has(e.pointerId)) pointers.delete(e.pointerId); if(pointers.size<2){ startDist=0; } if(pointers.size===0){ isPanning=false; } }
      stage.addEventListener('pointerdown', onPointerDown);
      stage.addEventListener('pointermove', onPointerMove);
      stage.addEventListener('pointerup', onPointerUp);
      stage.addEventListener('pointercancel', onPointerUp);
      // Double click / double tap to toggle zoom
      let lastTap=0;
      stage.addEventListener('click', e=>{ const now=Date.now(); if(now-lastTap<300){ if(scale===1){ scale=2; } else { resetTransforms(); } applyTransform(); } lastTap=now; });
      // Wheel zoom (desktop)
      stage.addEventListener('wheel', e=>{ const img=getPrimaryImage(); if(!img) return; if(!e.ctrlKey && Math.abs(e.deltaY)<40) return; e.preventDefault(); const rect=img.getBoundingClientRect(); const cx=e.clientX-rect.left; const cy=e.clientY-rect.top; const delta = e.deltaY<0?1.1:0.9; const newScale=Math.min(Math.max(scale*delta,1),5); const factor=newScale/scale; translateX = cx - factor*(cx-translateX); translateY = cy - factor*(cy-translateY); scale=newScale; applyTransform(); }, { passive:false });
      // Constrain translation on resize / navigation
      window.addEventListener('resize', ()=>{ if(scale>1) applyTransform(); });
      // Download current media
      downloadBtn?.addEventListener('click', ()=>{ const item=list[index]; if(!item) return; const a=document.createElement('a'); a.href=item.src; a.download=item.src.split('/').pop()||'media'; document.body.appendChild(a); a.click(); a.remove(); });
  // Swipe gesture (simple pointer start/end)
  let swipeStartX=0, swipeActive=false;
  stage.addEventListener('pointerdown', e=>{ swipeStartX=e.clientX; swipeActive=true; });
  stage.addEventListener('pointerup', e=>{ if(!swipeActive) return; const dx=e.clientX - swipeStartX; swipeActive=false; if(Math.abs(dx)>60){ if(dx<0) nextBtn.click(); else prevBtn.click(); } });
  // Focus trap
  function trapFocus(){ const f=[closeBtn, downloadBtn, prevBtn, nextBtn].filter(Boolean); if(!f.length) return; let i=0; f[0].focus(); function handler(e){ if(viewer.classList.contains('hidden')){ document.removeEventListener('keydown', handler); return;} if(e.key==='Tab'){ e.preventDefault(); i=(i+(e.shiftKey?-1:1)+f.length)%f.length; f[i].focus(); } } document.addEventListener('keydown', handler); }
  closeBtn.addEventListener('click', ()=>{ if(lastFocus) setTimeout(()=> lastFocus.focus(),50); });
    })();
    (function(){const openBtn=document.getElementById('openSearch'),modal=document.getElementById('searchModal'),closeBtn=document.getElementById('closeSearch'),input=document.getElementById('searchInputModal'),results=document.getElementById('searchResults'),empty=document.getElementById('searchEmpty'),sample=['Ama Kusi','Kwame Boateng','Marketplace: Laptop','Post: Productivity tips','Esi Nyarko','Event: Hack Night'];function open(){modal.classList.remove('hidden');document.body.classList.add('no-scroll');setTimeout(()=>input.focus(),50);}function close(){modal.classList.add('hidden');document.body.classList.remove('no-scroll');input.value='';results.innerHTML='';empty.classList.remove('hidden');}openBtn?.addEventListener('click',open);closeBtn?.addEventListener('click',close);modal.addEventListener('click',e=>{if(e.target===modal)close();});input.addEventListener('input',()=>{const q=input.value.trim().toLowerCase();results.innerHTML='';if(!q){empty.classList.remove('hidden');return;}empty.classList.add('hidden');const filtered=sample.filter(s=>s.toLowerCase().includes(q));if(!filtered.length){results.innerHTML='<div class="text-xs text-gray-400 text-center py-4">No matches</div>';return;}filtered.forEach(item=>{const div=document.createElement('div');div.className='px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 cursor-pointer';div.textContent=item;results.appendChild(div);});});})();

    // Event modal logic
    (function(){
      const modal=document.getElementById('eventModal');
      const closeBtns=[document.getElementById('closeEvent'), document.getElementById('evCloseBottom')];
      const titleEl=document.getElementById('evTitle');
      const imgEl=document.getElementById('evImage');
      const timeEl=document.getElementById('evTime');
      const locationEl=document.getElementById('evLocation');
      const detailsEl=document.getElementById('evDetails');
      const contactsList=document.getElementById('evContactsList');
      const dmBtn=document.getElementById('evDm');
      const shareBtn=document.getElementById('evShare');

      function buildContactItem(raw){
        const contact = (raw||'').trim();
        if(!contact) return null;
        let type='other', href='#', icon='info';
        if(/^(\+?\d[\d\s-]{5,})$/.test(contact)){ type='phone'; href='tel:'+contact.replace(/[^+\d]/g,''); icon='phone'; }
        else if(/@/.test(contact)){ type='email'; href='mailto:'+contact; icon='mail'; }
        else if(/^https?:\/\//i.test(contact)){ type='link'; href=contact; icon='external-link'; }
        else if(/^wa:\/\//i.test(contact)){ type='whatsapp'; href=contact; icon='message-circle'; }
        const wrap=document.createElement('div');
        wrap.className='flex items-center justify-between gap-2 bg-black/30 rounded px-2 py-1 group';
        const a=document.createElement('a');
        a.className='flex items-center gap-2 text-xs hover:underline';
        a.href=href; if(type==='link') a.target='_blank';
        a.rel='noopener noreferrer';
        a.innerHTML=`<i data-lucide="${icon}" class="w-3.5 h-3.5"></i><span class='truncate max-w-[140px]'>${contact}</span>`;
        const copy=document.createElement('button');
        copy.type='button';
        copy.setAttribute('data-copy', contact);
        copy.className='p-1 rounded hover:bg-white/10 text-gray-300';
        copy.innerHTML='<i data-lucide="copy" class="w-3.5 h-3.5"></i>';
        wrap.appendChild(a); wrap.appendChild(copy);
        return wrap;
      }

      function renderContacts(data){
        contactsList.innerHTML='';
        let contacts=[];
        if(Array.isArray(data.contacts)) contacts=data.contacts;
        else if(typeof data.contact==='string' && data.contact){
          // allow comma or | separated
          if(data.contact.includes(',')||data.contact.includes('|')) contacts=data.contact.split(/[|,]/);
          else contacts=[data.contact];
        }
        if(!contacts.length){
          contactsList.innerHTML='<p class="text-xs text-gray-400">No contact info provided.</p>';
          return;
        }
        contacts.map(c=>buildContactItem(c)).filter(Boolean).forEach(el=>contactsList.appendChild(el));
      }

      function open(data){
        titleEl.textContent=data.title||'Event';
        imgEl.style.backgroundImage=`url('${data.image||''}')`;
        timeEl.textContent=data.time||'';
        if(data.location){ locationEl.textContent=data.location; locationEl.classList.remove('hidden'); } else { locationEl.classList.add('hidden'); }
        detailsEl.textContent=data.details||'';
        dmBtn.dataset.dm = data.dm||'';
        renderContacts(data);
        modal.classList.remove('hidden');
        document.body.classList.add('no-scroll');
        if(window.lucide) lucide.createIcons();
        modal.setAttribute('data-opened','1');
        // Fallback visibility check
        requestAnimationFrame(()=>{
          if(modal.classList.contains('hidden')){
            console.warn('[EventModal] Modal still hidden after open call');
          }
        });
      }
  // expose globally for events list modal
  window.openEventDetails = open;
      function close(){ modal.classList.add('hidden'); document.body.classList.remove('no-scroll'); }
      function parseEventData(btn){
        const raw=btn.getAttribute('data-event');
        if(!raw) return {};
        try { return JSON.parse(raw); } catch(err){
          // Fallback: attempt relaxed eval (safe limited)
          try { /* eslint-disable no-new-func */ return Function('return ('+raw+')')(); } catch(e){ console.warn('Failed to parse event data', e, raw); return {}; }
        }
      }
      function handleEventButton(btn){
        const data=parseEventData(btn);
        if(!data || !Object.keys(data).length){
          // minimal inline feedback
          btn.disabled=true; const old=btn.textContent; btn.textContent='Data error'; setTimeout(()=>{ btn.disabled=false; btn.textContent=old; },1500);
          return;
        }
        console.log('[EventModal] Opening', data);
        open(data);
        // Last-resort assist if CSS conflict hides modal
        setTimeout(()=>{
          if(modal.classList.contains('hidden')){
            alert(`Event: ${data.title || ''}\nTime: ${data.time || ''}\n${data.details || ''}`);
          }
        },400);
      }
      document.addEventListener('click', e=>{
        const btn=e.target.closest('.see-event');
        if(btn){ handleEventButton(btn); }
        if(e.target===modal) close();
        const copyBtn=e.target.closest('[data-copy]');
        if(copyBtn){
          const val=copyBtn.getAttribute('data-copy');
            navigator.clipboard?.writeText(val);
            copyBtn.innerHTML='<i data-lucide="check" class="w-3.5 h-3.5 text-green-400"></i>';
            setTimeout(()=>{ copyBtn.innerHTML='<i data-lucide="copy" class="w-3.5 h-3.5"></i>'; if(window.lucide) lucide.createIcons(); },1200);
          if(window.lucide) lucide.createIcons();
        }
      });
      // Direct listeners (in case other handlers stop propagation)
      document.querySelectorAll('.see-event').forEach(b=>{
  b.addEventListener('click', e=>{ e.preventDefault(); e.stopPropagation(); handleEventButton(b); }, { passive:true });
      });
      closeBtns.forEach(b=> b?.addEventListener('click', close));
      dmBtn.addEventListener('click', ()=>{ const link=dmBtn.dataset.dm; if(link) window.location.href=link; });
      shareBtn.addEventListener('click', ()=>{ navigator.clipboard?.writeText(window.location.origin+window.location.pathname+'#event:'+titleEl.textContent); shareBtn.textContent='Copied'; setTimeout(()=> shareBtn.innerHTML='<i data-lucide="share-2" class="w-4 h-4"></i>Share', 1500); });
  // Debug helpers
  window.listEventButtons = ()=>[...document.querySelectorAll('.see-event')].map(b=>b.getAttribute('data-event'));
    })();
    // Events List Modal (See All)
    (function(){
      const trigger=document.getElementById('openEventsList');
      if(!trigger) return;
      // inject modal markup once
      const markup=`<div id="eventsListModal" class="fixed inset-0 z-[1001] hidden" role="dialog" aria-modal="true" aria-labelledby="eventsListTitle">\n        <div class='absolute inset-0 bg-black/70 backdrop-blur-sm' aria-hidden='true'></div>\n        <div class='absolute inset-x-0 top-0 mx-auto w-full max-w-sm p-4 animate-fade-in'>\n          <div class='bg-white/10 border border-white/20 rounded-2xl shadow-xl overflow-hidden flex flex-col max-h-[92vh]'>\n            <div class='flex items-center justify-between px-4 py-3 border-b border-white/10'>\n              <h3 id='eventsListTitle' class='text-sm font-semibold flex items-center gap-2'><i data-lucide="calendar" class="w-4 h-4"></i>All Events</h3>\n              <button id='closeEventsList' class='w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10' aria-label='Close events list'><i data-lucide="x" class="w-5 h-5"></i></button>\n            </div>\n            <div id='eventsListBody' class='overflow-y-auto divide-y divide-white/5'></div>\n          </div>\n        </div>\n      </div>`;
      document.body.insertAdjacentHTML('beforeend', markup);
      const modal=document.getElementById('eventsListModal');
      const listBody=document.getElementById('eventsListBody');
      const closeBtn=document.getElementById('closeEventsList');
      function parse(btn){
        const raw=btn.getAttribute('data-event');
        if(!raw) return null; try { return JSON.parse(raw); } catch(e){ return null; }
      }
      function buildRow(data){
        const div=document.createElement('div');
        div.className='flex items-center gap-3 px-4 py-3 hover:bg-white/5';
        div.innerHTML=`<div class='w-14 h-14 rounded-lg overflow-hidden bg-black/30 flex-shrink-0'><img src='${data.image||''}' alt='' class='w-full h-full object-cover'/></div><div class='flex-1 min-w-0'><p class='text-xs font-semibold truncate'>${data.title||'Event'}</p><p class='text-[10px] text-gray-400 truncate'>${data.time||''}</p></div><button class='see-details-btn text-[11px] bg-orange-600 hover:bg-orange-500 font-medium rounded px-2 py-1.5 flex items-center gap-1 flex-shrink-0'><i data-lucide="eye" class="w-3.5 h-3.5"></i><span>See Details</span></button>`;
        div.querySelector('.see-details-btn').addEventListener('click', ()=>{ window.openEventDetails && window.openEventDetails(data); });
        return div;
      }
      function open(){
        // collect events from page
        const buttons=[...document.querySelectorAll('.see-event')];
        const events=buttons.map(parse).filter(Boolean);
        listBody.innerHTML='';
        if(!events.length){ listBody.innerHTML="<div class='p-6 text-center text-xs text-gray-400'>No events available.</div>"; }
        else events.forEach(ev=> listBody.appendChild(buildRow(ev)));
        modal.classList.remove('hidden'); document.body.classList.add('no-scroll'); if(window.lucide) lucide.createIcons();
      }
      function close(){ modal.classList.add('hidden'); document.body.classList.remove('no-scroll'); }
      trigger.addEventListener('click', e=>{ e.preventDefault(); open(); });
      closeBtn.addEventListener('click', close);
      modal.addEventListener('click', e=>{ if(e.target===modal) close(); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && !modal.classList.contains('hidden')) close(); });
    })();
    // Ad modal logic (See Details for Campus Bites etc.)
    (function(){
      const modal=document.getElementById('adModal');
      if(!modal) return;
      const titleEl=document.getElementById('adTitle');
      const imgEl=document.getElementById('adImage');
      const tagEl=document.getElementById('adTag');
      const bodyEl=document.getElementById('adBody');
      const priceEl=document.getElementById('adPrice');
      const locationEl=document.getElementById('adLocation');
      const contactsEl=document.getElementById('adContacts');
      const actionBtn=document.getElementById('adAction');
      const closeBtns=[document.getElementById('closeAd'), document.getElementById('adCloseBottom')];
      const shareBtn=document.getElementById('adShare');
      function parse(btn){
        const raw=btn.getAttribute('data-ad'); if(!raw) return {}; try { return JSON.parse(raw); } catch(e){ try { return Function('return ('+raw+')')(); } catch(_){ return {}; } }
      }
      function buildContactItem(raw){
        const c=(raw||'').trim(); if(!c) return null; let type='text', href='#', icon='info';
        if(/^(\+?\d[\d\s-]{5,})$/.test(c)){ type='phone'; href='tel:'+c.replace(/[^+\d]/g,''); icon='phone'; }
        else if(/@/.test(c)){ type='mail'; href='mailto:'+c; icon='mail'; }
        else if(/^https?:\/\//i.test(c)){ type='link'; href=c; icon='external-link'; }
        const row=document.createElement('div'); row.className='flex items-center justify-between gap-2 bg-black/30 rounded px-2 py-1';
        row.innerHTML=`<a href="${href}" class="flex items-center gap-2 text-xs hover:underline" ${type==='link'? 'target="_blank" rel="noopener"':''}><i data-lucide="${icon}" class="w-3.5 h-3.5"></i><span class="truncate max-w-[140px]">${c}</span></a><button data-copy="${c}" class="p-1 rounded hover:bg-white/10 text-gray-300"><i data-lucide="copy" class="w-3.5 h-3.5"></i></button>`;
        return row;
      }
      function renderContacts(list){
        contactsEl.innerHTML='';
        (list||[]).map(buildContactItem).filter(Boolean).forEach(el=> contactsEl.appendChild(el));
        if(window.lucide) lucide.createIcons();
      }
      function open(data){
        titleEl.textContent=data.title||'Ad';
        imgEl.style.backgroundImage=`url('${data.image||''}')`;
        tagEl.textContent=data.tagline||'';
        bodyEl.textContent=data.body||'';
        priceEl.textContent=data.price||'';
        locationEl.textContent=data.location||'';
        renderContacts(Array.isArray(data.contact)? data.contact : Array.isArray(data.contacts)? data.contacts : []);
        if(data.actionLink){ actionBtn.classList.remove('hidden'); actionBtn.dataset.href=data.actionLink; actionBtn.firstElementChild?.classList.add('-rotate-45'); }
        else { actionBtn.classList.add('hidden'); delete actionBtn.dataset.href; }
        modal.classList.remove('hidden'); document.body.classList.add('no-scroll'); if(window.lucide) lucide.createIcons();
      }
      function close(){ modal.classList.add('hidden'); document.body.classList.remove('no-scroll'); }
      document.addEventListener('click', e=>{
        const btn=e.target.closest('.ad-see-details');
        if(btn){ const data=parse(btn); if(Object.keys(data).length){ open(data); } else { btn.disabled=true; const old=btn.textContent; btn.textContent='Data error'; setTimeout(()=>{ btn.disabled=false; btn.textContent=old; },1400); } }
        if(e.target===modal) close();
        const copyBtn=e.target.closest('[data-copy]');
        if(copyBtn){ const val=copyBtn.getAttribute('data-copy'); navigator.clipboard?.writeText(val); copyBtn.innerHTML='<i data-lucide="check" class="w-3.5 h-3.5 text-green-400"></i>'; setTimeout(()=>{ copyBtn.innerHTML='<i data-lucide="copy" class="w-3.5 h-3.5"></i>'; if(window.lucide) lucide.createIcons(); },1200); if(window.lucide) lucide.createIcons(); }
      });
      actionBtn?.addEventListener('click', ()=>{ const href=actionBtn.dataset.href; if(href){ if(href.startsWith('#')){ location.hash=href.slice(1); } else window.open(href, '_blank'); }});
      closeBtns.forEach(b=> b?.addEventListener('click', close));
      shareBtn?.addEventListener('click', ()=>{ navigator.clipboard?.writeText(window.location.href.split('#')[0]+'#ad:'+encodeURIComponent(titleEl.textContent)); shareBtn.textContent='Copied'; setTimeout(()=> shareBtn.innerHTML='<i data-lucide="share-2" class="w-4 h-4"></i>Share',1500); });
    })();
    // Post options (edit/delete) via ellipsis buttons
    (function(){
      const postsWrap=document.getElementById('posts');
      if(!postsWrap) return;
      let menuEl=null; let currentPost=null;
      function closeMenu(){ menuEl?.remove(); menuEl=null; currentPost=null; }
      document.addEventListener('click', e=>{
        if(e.target.closest('.post-options-menu')) return; // inside menu
        const trigger = e.target.closest('.post-options-trigger');
        if(trigger){
          const post=e.target.closest('article.post');
          if(!post) return;
          currentPost=post;
          closeMenu();
          menuEl=document.createElement('div');
          menuEl.className='post-options-menu absolute z-[1200] bg-black/90 backdrop-blur border border-white/10 rounded-lg shadow-lg text-xs min-w-[140px] py-1';
          menuEl.innerHTML=`<button data-act="edit" class='w-full text-left px-3 py-2 hover:bg-white/10 flex items-center gap-2'><i data-lucide="pencil" class='w-3.5 h-3.5'></i>Edit Post</button>
          <button data-act="delete" class='w-full text-left px-3 py-2 hover:bg-white/10 text-red-400 flex items-center gap-2'><i data-lucide="trash" class='w-3.5 h-3.5'></i>Delete</button>`;
          document.body.appendChild(menuEl);
          const rect=e.target.closest('button').getBoundingClientRect();
          menuEl.style.top= (window.scrollY + rect.bottom + 4)+'px';
          menuEl.style.left= Math.min(window.scrollX + rect.left, window.innerWidth - 160)+'px';
          if(window.lucide) lucide.createIcons();
  } else if(!e.target.closest('.post-options-menu')) closeMenu();
      });
      window.addEventListener('scroll', ()=> closeMenu(), { passive:true });
      document.addEventListener('click', e=>{
        const actBtn=e.target.closest('.post-options-menu button[data-act]');
        if(!actBtn) return;
        const act=actBtn.dataset.act; e.preventDefault();
        if(act==='delete' && currentPost){ currentPost.remove(); closeMenu(); showToast && showToast('Post deleted'); return; }
        if(act==='edit' && currentPost){
          const body=currentPost.querySelector('.px-4.pt-3.text-sm');
          if(!body) return; closeMenu();
          const original=body.getAttribute('data-original')||body.textContent.trim();
          body.setAttribute('data-original', original);
          body.innerHTML=`<textarea class='w-full bg-black/40 border border-white/20 rounded p-2 text-xs resize-none focus:outline-none' rows='3'>${original.replace(/</g,'&lt;')}</textarea>
          <div class='flex justify-end gap-2 mt-2 text-[10px]'>
            <button data-edit-cancel class='px-2 py-1 rounded bg-white/10 hover:bg-white/20'>Cancel</button>
            <button data-edit-save class='px-2 py-1 rounded bg-orange-600 hover:bg-orange-500 text-white font-medium'>Save</button>
          </div>`;
          const ta=body.querySelector('textarea'); ta?.focus();
        }
      });
      document.addEventListener('click', e=>{
        const cancel=e.target.closest('[data-edit-cancel]');
        const save=e.target.closest('[data-edit-save]');
        if(!cancel && !save) return;
        const body=e.target.closest('.px-4.pt-3.text-sm');
        if(!body) return;
        if(cancel){
          const orig=body.getAttribute('data-original')||'';
          body.innerHTML=parseTextContent(orig);
          if(window.lucide) lucide.createIcons();
          return;
        }
        if(save){
          const ta=body.querySelector('textarea');
          const text=ta?ta.value.trim():'';
          body.setAttribute('data-original', text);
          body.innerHTML=parseTextContent(text);
          if(window.lucide) lucide.createIcons();
          showToast && showToast('Post updated');
        }
      });
    })();
  </script>
  <script>
    // Hashtag filtering (consumes PairedFilterHashtag custom event emitted by shared-ui.js)
    (function(){
      const bar=document.getElementById('hashtagFilterBar');
      const postsWrap=document.getElementById('posts');
      if(!bar || !postsWrap) return;
      let activeTag='';
      function apply(){
        const arts=[...postsWrap.querySelectorAll('article.post')];
        if(!activeTag){
          arts.forEach(a=>{ a.classList.remove('opacity-30'); a.style.display=''; });
          bar.classList.add('hidden');
          bar.innerHTML='';
          return;
        }
        const tagLower=activeTag.toLowerCase();
        let anyMatch=false;
        arts.forEach(a=>{
          const body=a.querySelector('.px-4.pt-3.text-sm');
          const has=body && body.textContent.toLowerCase().includes('#'+tagLower);
            if(has){ a.classList.remove('hidden'); a.classList.remove('opacity-30'); anyMatch=true; }
            else { a.classList.add('opacity-30'); }
        });
        bar.classList.remove('hidden');
        bar.innerHTML=`<div class='flex items-center justify-between bg-white/10 border border-white/20 rounded-xl py-2 px-3 text-xs'>
          <div class='flex items-center gap-2'><span class='px-2 py-0.5 rounded-full bg-orange-600/30 text-orange-300 font-medium'>#${activeTag}</span>
          <span class='text-gray-300'>${anyMatch? 'Showing tagged posts':'No posts found with this tag'}</span></div>
          <button id='clearTagFilter' class='text-[11px] text-orange-400 hover:underline'>Clear</button></div>`;
        document.getElementById('clearTagFilter')?.addEventListener('click', ()=>{ activeTag=''; apply(); });
      }
      window.addEventListener('PairedFilterHashtag', e=>{
        const tag=(e.detail?.tag||'').trim();
        if(!tag) return;
        if(tag.toLowerCase()===activeTag.toLowerCase()){ activeTag=''; apply(); return; }
        activeTag=tag;
        apply();
        // ensure scroll near top so user sees filtered set
        window.scrollTo({ top:0, behavior:'smooth' });
      });
      })();
    })();
  </script>
</body>
</html>
